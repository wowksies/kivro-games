<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kivro • Elite</title>
    <meta name="description" content="Exclusive unblocked library.">

    <!-- PWA Manifest (Defaults to Kivro Logo) -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIktpdnJvIEVsaXRlIiwKICAic2hvcnRfbmFtZSI6ICJLaXZybyIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMDAwMDAwIiwKICAidGhlbWVfY29sb3IiOiAiIzAwMDAwMCIsCiAgImljb25zIjogW3sKICAgICJzcmMiOiAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0tBWUFaenovQ05NLUdhbWVzL21haW4vTG9nb2FjdHVhbC5wbmciLAogICAgInNpemVzIjogIjUxMng1MTIiLAogICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogIH1dCn0=">

    <!-- PWA Meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kivro Elite">
    <meta name="theme-color" content="#000000">

    <!-- Icons - Defaults to Kivro Logo -->
    <link id="apple-touch-icon" rel="apple-touch-icon" href="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png">
    <link id="dynamic-favicon" rel="icon" type="image/png" href="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        void: '#050505',
                        panel: '#0f0f0f',
                        gold: '#fbbf24',
                        accent: {
                            DEFAULT: '#8b5cf6',
                            glow: '#a78bfa',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'blob': 'blob 15s infinite',
                        'fade-up': 'fadeUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'shimmer': 'shimmer 2.5s linear infinite',
                        'pulse-gold': 'pulseGold 2s infinite',
                        'entrance': 'entrance 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'scan': 'scan 3s ease-in-out infinite',
                        'shine': 'shine 1.5s infinite',
                        'pop-in': 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'crt-on': 'turnOn 0.4s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeUp: {
                            '0%': { opacity: 0, transform: 'translateY(20px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '200% 0' },
                            '100%': { backgroundPosition: '-200% 0' }
                        },
                        pulseGold: {
                            '0%, 100%': { boxShadow: '0 0 0 0 rgba(251, 191, 36, 0.4)' },
                            '70%': { boxShadow: '0 0 0 10px rgba(251, 191, 36, 0)' }
                        },
                        entrance: {
                            '0%': { opacity: 0, transform: 'scale(0.95)' },
                            '100%': { opacity: 1, transform: 'scale(1)' }
                        },
                        popIn: {
                            '0%': { opacity: 0, transform: 'scale(0.8)' },
                            '100%': { opacity: 1, transform: 'scale(1)' }
                        },
                        scan: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' }
                        },
                        shine: {
                            '100%': { left: '125%' }
                        },
                        turnOn: {
                            '0%': { transform: 'scale(1, 0.01) translate3d(0, 0, 0)', filter: 'brightness(0)', opacity: 0 },
                            '60%': { transform: 'scale(1, 0.01) translate3d(0, 0, 0)', filter: 'brightness(2)', opacity: 1 },
                            '100%': { transform: 'scale(1, 1) translate3d(0, 0, 0)', filter: 'brightness(1)', opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

        body {
            background-color: #050505;
            color: #e4e4e7;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            overflow-x: hidden;
        }

        .liquid-bg {
            position: fixed; inset: 0; z-index: -2;
            background: #000;
            overflow: hidden;
        }
        
        .blob-1, .blob-2, .blob-3 {
            position: absolute;
            filter: blur(80px);
            opacity: 0.35;
            border-radius: 50%;
            animation: blob 20s infinite alternate;
        }
        
        /* GOLD / AMBER THEME BACKGROUND */
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #b45309; } /* Amber 700 */
        .blob-2 { bottom: -10%; right: -10%; width: 50vw; height: 50vw; background: #92400e; animation-delay: -5s; } /* Amber 800 */
        .blob-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: #d97706; animation-delay: -10s; opacity: 0.25; } /* Amber 600 */

        .smooth-card {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 28px;
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            opacity: 0; /* Hidden initially for staggered animation */
        }

        .smooth-card:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(40, 40, 40, 0.8);
            border-color: rgba(251, 191, 36, 0.3); /* Gold tint on hover */
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.6), 0 0 30px rgba(251, 191, 36, 0.1);
        }

        .img-wrapper {
            border-radius: 24px;
            overflow: hidden;
            mask-image: -webkit-radial-gradient(white, black);
        }

        .nav-pill {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border-radius: 99px;
            padding: 5px;
            display: flex;
            gap: 4px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .nav-btn {
            padding: 10px 24px;
            border-radius: 99px;
            color: #a1a1aa;
            font-weight: 700;
            font-size: 13px;
            letter-spacing: 0.02em;
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            white-space: nowrap;
        }

        @media (max-width: 1150px) {
            .nav-btn { padding: 8px 14px; font-size: 11px; }
            .nav-pill { padding: 3px; gap: 2px; }
        }

        .nav-btn.active {
            background: #fff;
            color: #000;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.25);
        }

        .vip-badge {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        /* High Tech Timer */
        .digital-timer {
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .shine-effect {
            position: relative;
            overflow: hidden;
        }
        .shine-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -75%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-25deg);
            transition: 0.5s;
        }
        .shine-effect:hover::before {
            animation: shine 0.75s;
        }

        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Notification Toast */
        #toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 14px 28px; border-radius: 16px; color: white; font-weight: bold; font-size: 14px;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 99999;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 10px;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        /* Install/Cloak Popup Styles */
        .select-icon {
            transition: all 0.3s ease;
        }
        .select-icon.selected {
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            transform: scale(1.1);
        }
        
        /* Typing Effect for Intro */
        .typing-effect {
            border-right: 2px solid #fbbf24;
            white-space: nowrap;
            overflow: hidden;
            animation: typing 3s steps(30, end), blink-caret .75s step-end infinite;
        }
        @keyframes typing { from { width: 0 } to { width: 100% } }
        @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: #fbbf24; } }
    </style>
</head>
<body class="antialiased selection:bg-gold/30 selection:text-white overflow-hidden" id="main-body">

    <div class="liquid-bg">
        <div class="blob-1"></div>
        <div class="blob-2"></div>
        <div class="blob-3"></div>
    </div>

    <!-- VIP WELCOME OVERLAY -->
    <div id="vip-welcome" class="fixed inset-0 z-[11000] bg-black flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-1000">
        <div class="text-center transform scale-95 transition-transform duration-1000" id="vip-welcome-content">
            <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-yellow-400 to-amber-600 p-[2px] animate-pulse-gold">
                <div class="w-full h-full rounded-full bg-black flex items-center justify-center">
                    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" class="w-12 h-12 animate-float">
                </div>
            </div>
            <h1 class="text-4xl md:text-5xl font-black text-white mb-2 tracking-tight">ACCESS GRANTED</h1>
            <p id="welcome-subtitle" class="text-amber-400 font-bold tracking-widest uppercase text-sm">Welcome to Elite Membership</p>
        </div>
    </div>

    <!-- SITE LOCK (With Sneaky CRT Intro Animation) -->
    <div id="site-lock" class="fixed inset-0 z-[10000] bg-black flex items-center justify-center overflow-y-auto overflow-x-hidden transition-all duration-700 opacity-0 animate-crt-on">
        <!-- Background Effects -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-0 left-0 w-full h-full bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"></div>
            <!-- GOLD GLOW EFFECTS -->
            <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-yellow-600/20 rounded-full blur-[120px] animate-blob"></div>
            <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-amber-600/20 rounded-full blur-[120px] animate-blob" style="animation-delay: -2s;"></div>
        </div>

        <div class="relative z-10 w-full max-w-4xl p-4 md:p-8 flex flex-col md:flex-row gap-8 items-stretch animate-fade-up">
            
            <!-- LEFT COLUMN: Better Introduction / System Stats -->
            <div class="flex-1 bg-zinc-900/80 backdrop-blur-2xl border border-white/10 rounded-3xl p-6 md:p-8 flex flex-col relative overflow-hidden group hover:border-amber-500/30 transition-colors">
                <!-- Glitchy System Status -->
                <div class="absolute top-0 right-0 bg-white/5 text-zinc-500 text-[9px] font-mono font-bold px-3 py-1 rounded-bl-xl z-20 border-l border-b border-white/5">
                    SYS.V.2.4 • SECURE
                </div>
                
                <div class="flex items-center gap-4 mb-8">
                     <div class="w-14 h-14 bg-white/5 rounded-2xl flex items-center justify-center border border-white/10 shadow-lg">
                        <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" class="w-9 h-9 opacity-100 animate-float">
                    </div>
                    <div>
                        <h1 class="text-3xl font-black text-white tracking-tight">KIVRO <span class="text-amber-400">ELITE</span></h1>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-[10px] text-zinc-400 font-bold uppercase tracking-[0.2em] typing-effect w-fit">Gateway Connected...</span>
                        </div>
                    </div>
                </div>

                <!-- High Tech Feature List -->
                <div class="space-y-4 mb-8 flex-1">
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5 relative overflow-hidden group/item hover:bg-white/10 transition-colors">
                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-amber-500/50"></div>
                        <h3 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-1">Protocol 01</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-bold text-white">Unrestricted Library</span>
                            <span class="text-[10px] bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded">Unlocked</span>
                        </div>
                    </div>
                    
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5 relative overflow-hidden group/item hover:bg-white/10 transition-colors">
                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-purple-500/50"></div>
                        <h3 class="text-xs font-bold text-purple-400 uppercase tracking-widest mb-1">Protocol 02</h3>
                         <div class="flex justify-between items-center">
                            <span class="text-sm font-bold text-white">Stealth Proxy V2</span>
                            <span class="text-[10px] bg-purple-500/20 text-purple-300 px-2 py-0.5 rounded">Active</span>
                        </div>
                    </div>

                    <div class="bg-white/5 p-4 rounded-xl border border-white/5 relative overflow-hidden group/item hover:bg-white/10 transition-colors">
                         <div class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500/50"></div>
                        <h3 class="text-xs font-bold text-blue-400 uppercase tracking-widest mb-1">Protocol 03</h3>
                         <div class="flex justify-between items-center">
                            <span class="text-sm font-bold text-white">Developer Menu</span>
                            <span class="text-[10px] bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded">Root Access</span>
                        </div>
                    </div>
                </div>

                <!-- Purchase Info -->
                 <div class="pt-4 border-t border-white/10 flex justify-between items-end">
                     <div>
                         <p class="text-[10px] text-zinc-500 uppercase font-bold mb-1 tracking-wider">Access Key Required</p>
                         <p class="text-xs text-zinc-400">Obtain via In-Person Cash Only</p>
                     </div>
                     <a href="mailto:kayazissigma@gmail.com" class="text-xs text-amber-400 font-bold hover:underline flex items-center gap-1">
                         Contact Support <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                     </a>
                 </div>
            </div>

            <!-- RIGHT COLUMN: Pricing & Login -->
            <div class="w-full md:w-80 flex flex-col gap-4">
                
                <!-- Pricing Stack -->
                <div class="bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-3xl p-2">
                    <div class="space-y-1">
                        <!-- 1 Day -->
                        <div class="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors cursor-default">
                            <div>
                                <div class="text-xs font-bold text-zinc-400">1 Day Pass</div>
                                <div class="text-[9px] text-zinc-600">Trial</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-zinc-300">3€</div>
                            </div>
                        </div>
                         <!-- 7 Days -->
                        <div class="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors cursor-default border border-transparent hover:border-white/5">
                            <div>
                                <div class="text-xs font-bold text-zinc-300">7 Day Pass</div>
                                <div class="text-[9px] text-zinc-500">Standard</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-white">7€</div>
                            </div>
                        </div>

                         <!-- THE HERO: 2 WEEKS -->
                        <div class="relative overflow-hidden rounded-xl border border-amber-500/40 p-3 group cursor-pointer transition-all hover:scale-[1.02] hover:shadow-[0_0_25px_rgba(245,158,11,0.2)] mt-1">
                            <!-- Shimmer Effect -->
                            <div class="absolute inset-0 bg-gradient-to-r from-amber-500/10 via-yellow-500/20 to-amber-500/10 animate-shimmer bg-[length:200%_100%]"></div>
                            
                            <!-- Badge -->
                            <div class="absolute top-0 right-0 bg-amber-500 text-black text-[8px] font-extrabold px-2 py-0.5 rounded-bl-lg shadow-lg z-10 tracking-wide">VIP CHOICE</div>
                            
                            <div class="flex items-center justify-between relative z-10">
                                <div class="flex items-center gap-3">
                                     <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-lg text-white">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-white">2 Weeks Elite</div>
                                        <div class="text-[9px] text-amber-200/80 font-medium">Full Priority Access</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-extrabold text-white text-shadow-sm">12€</div>
                                </div>
                            </div>
                            <!-- Features specifically for this plan -->
                            <div class="relative z-10 mt-2 pt-2 border-t border-amber-500/20 grid grid-cols-2 gap-1">
                                <span class="text-[8px] text-amber-100/70 font-bold flex items-center gap-1"><span class="w-1 h-1 bg-green-400 rounded-full"></span> 100% Uptime</span>
                                <span class="text-[8px] text-amber-100/70 font-bold flex items-center gap-1 justify-end"><span class="w-1 h-1 bg-blue-400 rounded-full"></span> Priority Support</span>
                            </div>
                        </div>

                        <!-- REFUND POLICY DISCLAIMER -->
                         <div class="mt-3 text-center">
                            <p class="text-[9px] text-red-400/80 font-bold uppercase tracking-widest opacity-80 hover:opacity-100 transition-opacity">⚠️ Non-Refundable Digital Keys</p>
                         </div>
                    </div>
                </div>

                <!-- Auth Box -->
                <div class="bg-black/60 backdrop-blur-xl border border-white/10 rounded-3xl p-5 flex flex-col gap-3 shadow-2xl h-full justify-center relative overflow-hidden">
                    <div class="text-center mb-1 relative z-10">
                        <div class="text-xs font-bold text-white uppercase tracking-widest flex items-center justify-center gap-2">
                             <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                            Secure Access
                        </div>
                    </div>
                    
                    <div class="relative group z-10">
                         <div class="absolute inset-0 bg-gradient-to-r from-transparent via-amber-500/20 to-transparent pointer-events-none opacity-0 group-focus-within:opacity-100 transition-opacity duration-500 animate-[scan_2s_linear_infinite]"></div>
                        
                        <input type="password" id="site-key-input" 
                            class="w-full bg-black/40 border-2 border-white/10 rounded-xl py-3 px-4 text-center text-white text-lg font-mono tracking-[0.3em] placeholder-zinc-700 focus:outline-none focus:border-amber-500 focus:bg-white/5 focus:shadow-[0_0_20px_rgba(245,158,11,0.2)] focus:ring-2 focus:ring-amber-500/20 transition-all relative z-10"
                            placeholder="XXX-XXX">
                    </div>

                    <div id="site-key-error" class="text-center text-red-500 text-[10px] font-bold h-4 opacity-0 transition-opacity uppercase tracking-widest z-10">Invalid Key</div>
                    
                    <button onclick="unlockSite()" class="shine-effect w-full py-3.5 rounded-xl bg-white text-black font-extrabold text-xs active:scale-[0.98] shadow-xl flex items-center justify-center gap-2 group z-10">
                        <span>AUTHENTICATE</span>
                        <svg class="w-4 h-4 group-hover:translate-x-0.5 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    </button>
                    
                    <button onclick="startVisualPreview()" class="w-full py-2 rounded-xl text-zinc-500 font-bold text-[10px] hover:text-white transition-colors z-10">
                        Just Browsing? <span class="underline decoration-zinc-700 underline-offset-2 hover:decoration-white">View Preview</span>
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- MAIN APP CONTENT -->
    <div id="app-content" class="opacity-0 scale-95 transition-all duration-700 blur-sm h-screen overflow-y-auto">
        <nav class="fixed top-0 left-0 right-0 z-50 bg-black/10 backdrop-blur-md border-b border-white/5">
            <div class="max-w-7xl mx-auto px-6 h-24 flex items-center justify-between relative">
                <div class="flex items-center gap-4 cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" class="w-10 h-10 rounded-2xl shadow-lg animate-float">
                </div>

                <!-- NAVIGATION -->
                <div class="nav-pill hidden sm:flex absolute left-1/2 transform -translate-x-1/2">
                    <button class="nav-btn active" data-tab="Games">Library</button>
                    <button class="nav-btn" data-tab="Apps">Apps</button>
                    <button class="nav-btn" id="menu-tab-btn" data-tab="Menu">Menu</button>
                    <button class="nav-btn" id="proxy-tab-btn" data-tab="Proxy">Proxy</button>
                    <button class="nav-btn" data-tab="Favs">Saved</button>
                </div>

                <!-- RIGHT CONTROLS (Updated HUD Timer) -->
                <div class="flex items-center gap-4">
                    <div id="vip-status-badge" class="flex items-center gap-2 mr-2">
                        <span class="text-[10px] md:text-[8px] font-black vip-badge tracking-widest uppercase truncate max-w-[80px] md:max-w-none">VIP MEMBER</span>
                    </div>

                    <!-- HUD TIMER -->
                    <div class="hidden md:flex flex-col items-end">
                        <div class="text-[8px] text-zinc-600 uppercase tracking-widest font-bold mb-0.5">Session Time</div>
                        <div class="flex items-center gap-2 px-3 py-1.5 rounded bg-black/40 border border-white/5 shadow-inner">
                            <div id="timer-dot" class="w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse shadow-[0_0_8px_rgba(245,158,11,0.8)]"></div>
                            <span id="header-timer" class="font-mono text-xs font-bold text-amber-500 tabular-nums tracking-widest digital-timer">00:00:00</span>
                        </div>
                    </div>

                    <button onclick="openCloakModal()" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-zinc-400 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                    </button>
                    
                    <button id="search-toggle" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-zinc-400 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                    </button>
                    
                    <div class="sm:hidden">
                        <button class="bg-white/10 backdrop-blur-md text-white px-5 py-3 rounded-full text-sm font-bold" id="mobile-menu-trigger">Menu</button>
                    </div>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden sm:hidden bg-black/90 backdrop-blur-2xl border-b border-white/5 p-4 absolute w-full left-0 top-24">
                <div class="flex flex-col gap-2">
                    <button class="nav-btn text-center w-full py-4" data-tab="Games">Library</button>
                    <button class="nav-btn text-center w-full py-4" data-tab="Apps">Apps</button>
                    <button class="nav-btn text-center w-full py-4" id="mobile-menu-tab-btn" data-tab="Menu">Kivro Menu</button>
                    <button class="nav-btn text-center w-full py-4" id="mobile-proxy-tab-btn" data-tab="Proxy">Proxy</button>
                    <button class="nav-btn text-center w-full py-4" data-tab="Favs">Saved</button>
                </div>
            </div>

            <div id="search-bar" class="hidden absolute top-24 left-0 right-0 bg-black/80 backdrop-blur-2xl border-b border-white/5 p-6">
                <div class="max-w-3xl mx-auto">
                    <input type="text" id="global-search" placeholder="Search..." class="liquid-input w-full py-5 px-8 text-white text-lg">
                </div>
            </div>
        </nav>

        <main class="pt-36 pb-12 px-4 max-w-7xl mx-auto min-h-screen">
            <!-- DASHBOARD HEADER -->
            <div id="dashboard-header" class="text-center mb-16 fade-up">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/5 border border-white/5 text-zinc-400 text-[10px] font-bold mb-6">
                    <div id="system-status-dot" class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span id="system-status-text">Status: System Secure</span>
                </div>
                <h1 id="page-title" class="text-4xl md:text-6xl font-extrabold text-white mb-6 tracking-tight">Premium Library</h1>
                <p class="text-zinc-400 font-medium text-lg">Accessing <span id="item-count" class="text-white font-bold">0</span> applications.</p>
                
                <!-- NEW PURCHASE CARD -->
                <div id="free-mode-cta" class="hidden mt-10 max-w-md mx-auto animate-fade-up">
                    <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-amber-600/20 to-black border border-amber-500/30 p-8 backdrop-blur-md shadow-2xl">
                        <div class="absolute -top-10 -right-10 w-32 h-32 bg-amber-500/30 blur-3xl rounded-full"></div>
                        
                        <div class="relative z-10 text-left">
                            <h3 class="text-2xl font-extrabold text-white mb-2 text-center">Get Premium Access</h3>
                            <p class="text-sm text-zinc-400 mb-6 text-center">Unlock Proxy • Menu • All Games</p>
                            
                            <div class="space-y-3">
                                <div class="flex items-center gap-4 bg-white/5 p-4 rounded-xl border border-white/5">
                                    <div class="w-10 h-10 flex-shrink-0 rounded-full bg-green-500/20 flex items-center justify-center text-green-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                    </div>
                                    <div class="text-left">
                                        <p class="text-xs font-bold text-zinc-500 uppercase">Payment Method</p>
                                        <p class="text-white font-bold">Cash Only (In Person)</p>
                                    </div>
                                </div>

                                <div class="flex items-center gap-4 bg-white/5 p-4 rounded-xl border border-white/5">
                                     <div class="w-10 h-10 flex-shrink-0 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                    </div>
                                    <div class="text-left overflow-hidden">
                                        <p class="text-xs font-bold text-zinc-500 uppercase">Contact</p>
                                        <p class="text-white font-bold select-all truncate">kayazissigma@gmail.com</p>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="mt-6 text-xs text-center text-zinc-500">Find me IRL or email to purchase a key.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GRID -->
            <div id="game-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-6 sm:gap-8"></div>

            <!-- DEDICATED MENU PAGE -->
            <div id="menu-view" class="hidden max-w-2xl mx-auto animate-fade-up">
                <div class="text-center mb-12">
                    <div class="w-24 h-24 bg-white/5 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-[0_0_40px_rgba(251,191,36,0.1)] border border-white/10">
                        <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" class="w-12 h-12 opacity-80 animate-float">
                    </div>
                    <h2 class="text-4xl font-extrabold text-white mb-4">Kivro Menu V2</h2>
                    <p class="text-zinc-400">The ultimate utility belt for your browser sessions.</p>
                </div>

                <div class="bg-white/5 border border-white/10 rounded-3xl p-8 mb-8 backdrop-blur-sm relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-amber-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <div class="relative z-10 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Installation Script</h3>
                        <p class="text-xs text-zinc-500 mb-6 uppercase tracking-widest">Universal Bookmarklet</p>
                        
                        <button onclick="copyBookmarklet()" class="w-full py-4 rounded-xl bg-white text-black font-bold hover:bg-amber-50 hover:scale-[1.02] active:scale-[0.98] transition-all shadow-lg flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                            Tap to Copy Code
                        </button>
                        <p class="mt-4 text-[10px] text-zinc-600">Auto-updating script • No installation required</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-sm font-bold text-zinc-500 uppercase tracking-widest pl-2">iPad / iPhone Setup</h3>
                    
                    <div class="bg-black/20 border border-white/5 rounded-2xl p-4 flex gap-4 items-center">
                        <span class="flex-shrink-0 w-8 h-8 rounded-full bg-white/5 text-white flex items-center justify-center font-bold text-sm">1</span>
                        <p class="text-sm text-zinc-400">Tap <b class="text-white">Copy Code</b> above.</p>
                    </div>
                    <div class="bg-black/20 border border-white/5 rounded-2xl p-4 flex gap-4 items-center">
                        <span class="flex-shrink-0 w-8 h-8 rounded-full bg-white/5 text-white flex items-center justify-center font-bold text-sm">2</span>
                        <p class="text-sm text-zinc-400">Tap <b class="text-white">Share</b> (Square Arrow) → <b class="text-white">Add to Favorites</b>.</p>
                    </div>
                    <div class="bg-black/20 border border-white/5 rounded-2xl p-4 flex gap-4 items-center">
                        <span class="flex-shrink-0 w-8 h-8 rounded-full bg-white/5 text-white flex items-center justify-center font-bold text-sm">3</span>
                        <p class="text-sm text-zinc-400">Open Bookmarks → Edit → Select the new favorite.</p>
                    </div>
                    <div class="bg-black/20 border border-white/5 rounded-2xl p-4 flex gap-4 items-center">
                        <span class="flex-shrink-0 w-8 h-8 rounded-full bg-white/5 text-white flex items-center justify-center font-bold text-sm">4</span>
                        <p class="text-sm text-zinc-400">Delete the URL and <b class="text-white">Paste</b> the code.</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="toast">
        <svg class="w-5 h-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
        <span id="toast-msg">Action Completed</span>
    </div>

    <!-- CLOAK / INSTALL POPUP -->
    <div id="cloak-modal" class="fixed inset-0 z-[12000] bg-black/80 backdrop-blur-md flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="bg-[#141414]/90 border border-white/10 rounded-2xl p-6 shadow-2xl max-w-lg w-[92%] relative overflow-hidden transform scale-95 transition-transform duration-300">
            <!-- Close Button -->
            <button onclick="closeCloakModal()" class="absolute top-4 right-4 text-zinc-500 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>

            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-white mb-2">App Disguise</h2>
                <p class="text-zinc-400 text-sm">Choose an icon to cloak the app on your home screen.</p>
            </div>

            <!-- Icon Selector -->
            <div class="grid grid-cols-3 gap-4 mb-8">
                 <!-- Teams -->
                 <div class="flex flex-col items-center gap-3 cursor-pointer group" onclick="setCloak('https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/teamsfake.png', 'Teams')">
                    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/teamsfake.png" class="w-16 h-16 rounded-xl shadow-lg border-2 border-transparent hover:border-indigo-500 hover:scale-105 transition-all select-icon">
                    <span class="text-xs font-bold text-zinc-500 group-hover:text-white">Teams</span>
                 </div>
                 <!-- Kahoot -->
                 <div class="flex flex-col items-center gap-3 cursor-pointer group" onclick="setCloak('https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Kahoot%20fake.png', 'Kahoot!')">
                    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Kahoot%20fake.png" class="w-16 h-16 rounded-xl shadow-lg border-2 border-transparent hover:border-purple-500 hover:scale-105 transition-all select-icon">
                    <span class="text-xs font-bold text-zinc-500 group-hover:text-white">Kahoot!</span>
                 </div>
                 <!-- OneNote (Default) -->
                 <div class="flex flex-col items-center gap-3 cursor-pointer group" onclick="setCloak('https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/onsigma67.png', 'OneNote')">
                    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/onsigma67.png" class="w-16 h-16 rounded-xl shadow-lg border-2 border-transparent hover:border-pink-500 hover:scale-105 transition-all select-icon">
                    <span class="text-xs font-bold text-zinc-500 group-hover:text-white">OneNote</span>
                 </div>
            </div>

            <div class="bg-white/5 rounded-xl p-4 border border-white/5 text-center">
                <p class="text-xs text-zinc-400 mb-2 font-bold uppercase tracking-wide">Installation Steps</p>
                <div class="flex items-center justify-center gap-2 text-sm text-zinc-300">
                    <span>1. Pick Icon</span> <span class="text-zinc-600">→</span> <span>2. Tap Share <svg class="w-4 h-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg></span> <span class="text-zinc-600">→</span> <span>3. Add to Home</span>
                </div>
            </div>
        </div>
    </div>

    <!-- AUTO INSTALL PROMPT (Visible on both pages via Z-Index) -->
    <div id="install-modal" class="fixed bottom-0 left-0 right-0 z-[12000] p-4 translate-y-full transition-transform duration-500 ease-[cubic-bezier(0.2,0.8,0.2,1)]">
        <div class="bg-[#141414]/90 backdrop-blur-xl border border-white/10 rounded-2xl p-5 shadow-2xl max-w-md mx-auto relative overflow-hidden">
            <!-- Close Button -->
            <button onclick="dismissInstall()" class="absolute top-3 right-3 text-zinc-500 hover:text-white">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <div class="flex gap-4">
                 <img id="install-icon-preview" src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" class="w-14 h-14 rounded-xl shadow-lg">
                 <div class="flex-1">
                     <h3 class="text-white font-bold text-lg leading-tight mb-1">Install App</h3>
                     <p id="install-text" class="text-zinc-400 text-xs leading-relaxed">
                        Install Kivro Elite for fullscreen & better performance.
                     </p>
                     <!-- iOS Instructions -->
                     <div id="ios-instructions" class="hidden mt-3 text-xs text-amber-400 font-bold flex items-center gap-2">
                         <span>Tap <svg class="w-4 h-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg> then "Add to Home Screen" <svg class="w-4 h-4 inline bg-white/20 rounded ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg></span>
                     </div>
                     <!-- Android/Desktop Button -->
                     <button id="install-btn" class="hidden mt-3 w-full py-2 bg-white text-black font-bold rounded-lg text-xs hover:bg-zinc-200 transition-colors" onclick="triggerInstall()">Add to Home Screen</button>
                     <!-- Manual Instructions Fallback -->
                     <div id="manual-install" class="hidden mt-3 text-xs text-zinc-500 font-medium">
                        Open browser menu and select "Add to Home Screen" or "Install App".
                     </div>
                 </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxEgIRNKug7X2GY6dl6G8l0eYvDWrheyTOm3b5vPHYwNyVnhGbMuvNnEO20Kz57NMjA/exec";
        const THUMB_BASE = "https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Thumbnails/";
        const GITHUB_BASE = "https://raw.githack.com/HTML5GameArchive/gfiles/master/games/";
        
        let favorites = JSON.parse(localStorage.getItem('kivro_favs') || '[]');
        let currentTab = 'Games';
        let countdownInterval = null;
        let isPreviewMode = false;
        let sessionCheckInterval = null; // POLLING CHECK

        // --- CLOAKING LOGIC ---
        function openCloakModal() {
            const modal = document.getElementById('cloak-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
                modal.querySelector('div').classList.add('scale-100');
            }, 10);
        }

        function closeCloakModal() {
            const modal = document.getElementById('cloak-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.remove('scale-100');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        function setCloak(iconUrl, appName) {
            // 1. Update Apple Touch Icon
            const appleIcon = document.getElementById('apple-touch-icon');
            if(appleIcon) appleIcon.href = iconUrl;

            // 2. Update Favicon (for desktop tabs)
            const favIcon = document.getElementById('dynamic-favicon');
            if(favIcon) favIcon.href = iconUrl;

            // 3. Update Document Title
            document.title = appName;

            // 4. Update Apple Web App Title (Meta)
            let appleTitleMeta = document.querySelector('meta[name="apple-mobile-web-app-title"]');
            if (!appleTitleMeta) {
                appleTitleMeta = document.createElement('meta');
                appleTitleMeta.setAttribute('name', 'apple-mobile-web-app-title');
                document.head.appendChild(appleTitleMeta);
            }
            appleTitleMeta.setAttribute('content', appName);

            // 5. Update Preview in Install Modal (if visible)
            document.getElementById('install-icon-preview').src = iconUrl;

            // 6. UI Feedback
            showToast(`Disguised as ${appName}`);
            closeCloakModal();
        }

        // --- INSTALL POPUP LOGIC ---
        let deferredPrompt;
        const installModal = document.getElementById('install-modal');
        const iosText = document.getElementById('ios-instructions');
        const installBtn = document.getElementById('install-btn');
        const manualText = document.getElementById('manual-install');

        // Check install status on load
        window.addEventListener('load', () => {
             // 1. Session Resume Logic
             localStorage.removeItem('kivro_preview_session');
             const session = JSON.parse(localStorage.getItem('kivro_premium_session'));
             if (session) {
                 if (!session.isUnlimited && session.expiresAt < Date.now()) {
                     localStorage.removeItem('kivro_premium_session');
                 } else {
                     showVipWelcome(session);
                 }
             }

             // 2. Install Logic
             const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
             
             if (!isStandalone && !localStorage.getItem('kivro_install_dismissed')) {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                
                setTimeout(() => {
                    const installModal = document.getElementById('install-modal');
                    installModal.classList.remove('translate-y-full');
                    
                    if (isIOS) {
                        document.getElementById('ios-instructions').classList.remove('hidden');
                    } else if (deferredPrompt) {
                        document.getElementById('install-btn').classList.remove('hidden');
                    } else {
                        document.getElementById('manual-install').classList.remove('hidden');
                    }
                }, 2000); 
             }
        });

        // Listen for install prompt (Android/Desktop)
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!installModal.classList.contains('translate-y-full')) {
                manualText.classList.add('hidden');
                installBtn.classList.remove('hidden');
            }
        });

        function dismissInstall() {
            installModal.classList.add('translate-y-full');
            localStorage.setItem('kivro_install_dismissed', 'true');
        }

        function triggerInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        dismissInstall();
                    }
                    deferredPrompt = null;
                });
            }
        }

        // UPDATED BOOKMARKLET: Uses raw.githack.com to prevent MIME type blocking
        const BOOKMARKLET_CODE = "javascript:(function(){if(document.getElementById('kivro-menu-v2'))return;const MENU_ITEMS=[{name:\"🦄 Blooket Cheats (GUI)\",action:function(){var s=document.createElement('script');s.src='https://raw.githack.com/wowksies/Bookletkiv/main/gui.js';document.body.appendChild(s);alert('Blooket GUI Injecting...');}},{name:\"👆 iPad Autoclicker (Target)\",action:function(){if(window.kivroAC){clearInterval(window.kivroAC);window.kivroAC=null;var t=document.getElementById('kivro-ac-target');if(t)t.remove();alert('Autoclicker: OFF');}else{var t=document.createElement('div');t.id='kivro-ac-target';t.style.cssText='position:fixed;top:50%;left:50%;width:60px;height:60px;margin:-30px 0 0 -30px;border:4px solid rgba(255,0,60,0.6);border-radius:50%;z-index:9999999999;box-shadow:0 0 15px rgba(255,0,60,0.4);pointer-events:none;transition:transform 0.1s;';var h=document.createElement('div');h.style.cssText='position:absolute;top:-20px;left:50%;transform:translateX(-50%);width:30px;height:30px;background:rgba(255,0,60,0.9);border-radius:50%;cursor:move;pointer-events:auto;box-shadow:0 2px 8px rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;color:white;font-size:16px;font-weight:bold;';h.innerText='✢';t.appendChild(h);var c=document.createElement('div');c.style.cssText='position:absolute;top:50%;left:50%;width:4px;height:4px;background:red;transform:translate(-50%,-50%);border-radius:50%;';t.appendChild(c);document.body.appendChild(t);let d=false;const mv=(e)=>{if(!d)return;e.preventDefault();const cx=e.touches?e.touches[0].clientX:e.clientX;const cy=e.touches?e.touches[0].clientY:e.clientY;t.style.left=cx+'px';t.style.top=cy+'px';};const dn=(e)=>{d=true;e.preventDefault();t.style.transform='scale(1.1)';};const up=()=>{d=false;t.style.transform='scale(1)';};h.addEventListener('mousedown',dn);h.addEventListener('touchstart',dn);document.addEventListener('mousemove',mv);document.addEventListener('touchmove',mv);document.addEventListener('mouseup',onUp);document.addEventListener('touchend',onUp);alert('Autoclicker: ON. Drag the red knob to move.');window.kivroAC=setInterval(function(){var r=t.getBoundingClientRect();var el=document.elementFromPoint(r.left+r.width/2,r.top+r.height/2);if(el&&el!==t&&el!==h&&el!==c){el.click();el.dispatchEvent(new MouseEvent('mousedown'));el.dispatchEvent(new MouseEvent('mouseup'));}},50);}}},{name:\"🌊 History Flooder\",action:function(){var s=document.createElement('script');s.src='https://raw.githack.com/DevBubba/Bookmarklets/main/Tools/HistoryFlooder.js';document.body.appendChild(s);alert('History Flooder Loading...');}},{name:\"📺 Fullscreen Anywhere\",action:function(){var s=document.createElement('script');s.src='https://raw.githack.com/DevBubba/Bookmarklets/main/Tools/InstantFullscreen.js';document.body.appendChild(s);alert('Enabling Fullscreen...');}}];const css=`#kivro-menu-v2{position:fixed;top:100px;left:100px;width:260px;display:flex;flex-direction:column;background:rgba(20,20,30,0.65);backdrop-filter:blur(25px) saturate(180%);-webkit-backdrop-filter:blur(25px) saturate(180%);border:1px solid rgba(255,255,255,0.15);border-top:1px solid rgba(255,255,255,0.3);border-left:1px solid rgba(255,255,255,0.3);border-radius:24px;box-shadow:0 20px 50px rgba(0,0,0,0.5),inset 0 0 20px rgba(255,255,255,0.05);font-family:system-ui,-apple-system,sans-serif;color:white;z-index:2147483647;transition:width 0.3s,height 0.3s,border-radius 0.3s,background 0.3s;overflow:hidden;user-select:none}#kivro-menu-v2.minimized{width:60px;height:60px;border-radius:50%;background:url('https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png');background-size:cover;background-position:center;box-shadow:0 0 20px rgba(139,92,246,0.6);border:2px solid rgba(255,255,255,0.5);cursor:pointer}#kivro-menu-v2.minimized>*{display:none !important}.kv-header{padding:16px;background:linear-gradient(to right,rgba(255,255,255,0.05),transparent);border-bottom:1px solid rgba(255,255,255,0.05);display:flex;justify-content:space-between;align-items:center}#kivro-menu-v2.minimized .kv-header{display:none}.kv-title{font-weight:800;font-size:12px;letter-spacing:1.5px;color:#a78bfa;text-transform:uppercase}.kv-controls{display:flex;gap:8px}.kv-btn-ctrl{width:24px;height:24px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;font-family:monospace}.kv-body{padding:12px;max-height:400px;overflow-y:auto}.kv-btn{width:100%;padding:14px;margin-bottom:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:14px;color:#e4e4e7;font-size:13px;font-weight:600;text-align:left;cursor:pointer;transition:all 0.2s ease}.kv-btn:active{transform:scale(0.98);background:rgba(139,92,246,0.2)}`;const style=document.createElement('style');style.textContent=css;document.head.appendChild(style);const ui=document.createElement('div');ui.id='kivro-menu-v2';ui.innerHTML='<div class=\"kv-header\"><span class=\"kv-title\">KIVRO PREMIUM</span><div class=\"kv-controls\"><div id=\"kv-min\" class=\"kv-btn-ctrl\">_</div><div id=\"kv-close\" class=\"kv-btn-ctrl\">X</div></div></div><div class=\"kv-body\"></div>';document.body.appendChild(ui);const body=ui.querySelector('.kv-body');MENU_ITEMS.forEach(item=>{const btn=document.createElement('button');btn.className='kv-btn';btn.innerText=item.name;const run=(e)=>{e.stopPropagation();try{item.action()}catch(e){alert(e)}};btn.onclick=run;btn.ontouchend=run;body.appendChild(btn)});let isMin=false;let isDragging=false;let hasMoved=false;let startX,startY,initX,initY;const minBtn=ui.querySelector('#kv-min');const closeBtn=ui.querySelector('#kv-close');const header=ui.querySelector('.kv-header');const doMin=(e)=>{e.stopPropagation();e.preventDefault();isMin=true;ui.classList.add('minimized')};const doClose=(e)=>{e.stopPropagation();e.preventDefault();ui.remove();style.remove()};minBtn.ontouchend=doMin;minBtn.onclick=doMin;closeBtn.ontouchend=doClose;closeBtn.onclick=doClose;const stopProp=(e)=>{e.stopPropagation()};minBtn.ontouchstart=stopProp;minBtn.onmousedown=stopProp;closeBtn.ontouchstart=stopProp;closeBtn.onmousedown=stopProp;const onDown=(e)=>{if(e.target.closest('.kv-controls'))return;isDragging=true;hasMoved=false;const t=e.touches?e.touches[0]:e;startX=t.clientX;startY=t.clientY;initX=ui.offsetLeft;initY=ui.offsetTop;ui.style.transition='none'};const onMove=(e)=>{if(!isDragging)return;const t=e.touches?e.touches[0]:e;const dx=t.clientX-startX;const dy=t.clientY-startY;if(Math.abs(dx)>5||Math.abs(dy)>5)hasMoved=true;ui.style.left=(initX+dx)+'px';ui.style.top=(initY+dy)+'px';if(e.cancelable)e.preventDefault()};const onUp=(e)=>{if(!isDragging)return;isDragging=false;ui.style.transition='width 0.3s, height 0.3s, border-radius 0.3s, background 0.3s';if(isMin&&!hasMoved){isMin=false;ui.classList.remove('minimized')}};ui.addEventListener('mousedown',onDown);ui.addEventListener('touchstart',onDown,{passive:false});document.addEventListener('mousemove',onMove);document.addEventListener('touchmove',onMove,{passive:false});document.addEventListener('mouseup',onUp);document.addEventListener('touchend',onUp)})();void(0);";

        function getDeviceId() {
            let id = localStorage.getItem('kivro_device_token');
            if (!id) {
                id = 'KIV-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now().toString(36);
                localStorage.setItem('kivro_device_token', id);
            }
            return id;
        }

        async function unlockSite() {
            const input = document.getElementById('site-key-input');
            const error = document.getElementById('site-key-error');
            const btn = document.querySelector('.bg-black\\/60 button'); 
            const key = input.value.trim();
            const deviceId = getDeviceId();

            if (!key) {
                showError("Enter Key");
                return;
            }

            // Simple loading state
            const originalText = btn.innerHTML;
            btn.innerHTML = "<span>DECRYPTING...</span>";
            btn.disabled = true;

            try {
                const response = await fetch(`${API_URL}?key=${encodeURIComponent(key)}&deviceId=${encodeURIComponent(deviceId)}&action=login`);
                const data = await response.json();

                if (data.valid) {
                    const session = {
                        key: key,
                        expiresAt: data.expiresAt,
                        isUnlimited: data.isUnlimited === true, // STRICT BOOLEAN CHECK
                        timestamp: Date.now(),
                        type: 'premium',
                        isAdmin: data.isAdmin
                    };
                    localStorage.setItem('kivro_premium_session', JSON.stringify(session));
                    
                    showVipWelcome(session);

                } else {
                    showError(data.message || "Invalid Access");
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            } catch (err) {
                showError("Server Error");
                console.error(err);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }

            function showError(msg) {
                error.innerText = msg;
                error.classList.remove('opacity-0');
                setTimeout(() => error.classList.add('opacity-0'), 3000);
            }
        }
        
        // --- NEW: VIP WELCOME ANIMATION ---
        function showVipWelcome(session) {
            const welcome = document.getElementById('vip-welcome');
            const content = document.getElementById('vip-welcome-content');
            
            // Check for Admin status to customize message
            if (session.isAdmin) {
                document.querySelector('#vip-welcome-content h1').innerText = "SYSTEM OVERRIDE";
                document.getElementById('welcome-subtitle').innerText = "Welcome, Administrator";
                document.getElementById('welcome-subtitle').classList.replace('text-amber-400', 'text-red-500');
            } else {
                 // Reset to default in case previous session was admin
                document.querySelector('#vip-welcome-content h1').innerText = "ACCESS GRANTED";
                document.getElementById('welcome-subtitle').innerText = "Welcome to Elite Membership";
                document.getElementById('welcome-subtitle').classList.replace('text-red-500', 'text-amber-400');
            }

            // 1. Fade in the black overlay
            welcome.classList.remove('pointer-events-none', 'opacity-0');
            
            // 2. Animate content entrance
            setTimeout(() => {
                content.classList.remove('scale-95');
                content.classList.add('animate-entrance');
            }, 100);

            // 3. After 2.5 seconds, enter system and fade out overlay
            setTimeout(() => {
                enterSystem(session);
                
                // Fade out welcome screen
                welcome.classList.add('opacity-0', 'pointer-events-none');
                
                // Show a nice toast once inside
                setTimeout(() => showToast(session.isAdmin ? "Root Access Granted" : "Welcome back, Elite Member"), 800);
            }, 2500);
        }

        // --- PREVIEW MODE LOGIC ---
        function startVisualPreview() {
            const session = {
                type: 'preview',
                expiresAt: Date.now() + 3600000 
            };
            enterSystem(session);
        }

        function enterSystem(session) {
            document.getElementById('site-lock').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('site-lock').style.display = 'none';
                document.getElementById('app-content').classList.remove('opacity-0', 'scale-95', 'blur-sm');
                document.getElementById('main-body').classList.remove('overflow-hidden');
                
                isPreviewMode = (session.type === 'preview');
                
                // Update UI based on mode
                if (isPreviewMode) {
                    document.getElementById('page-title').innerText = "Library Preview";
                    document.getElementById('system-status-text').innerText = "Status: Read-Only Mode";
                    document.getElementById('system-status-dot').classList.remove('bg-green-500');
                    document.getElementById('system-status-dot').classList.add('bg-yellow-500');
                    
                    // Show Buy Card
                    document.getElementById('free-mode-cta').classList.remove('hidden');
                    
                    // Hide Premium Badges
                    document.getElementById('vip-status-badge').classList.add('hidden');
                } else {
                    // Full access
                    startSessionCheck(session.key);
                    
                    // Check for Admin Theme Override
                    if (session.isAdmin) {
                        applyAdminTheme();
                    } else {
                        // Standard Premium UI
                        document.getElementById('system-status-text').innerText = "Status: VIP Access Active";
                        document.getElementById('system-status-text').classList.add('text-amber-400');
                        document.getElementById('system-status-dot').classList.remove('bg-green-500');
                        document.getElementById('system-status-dot').classList.add('bg-amber-500');
                    }
                    
                    // Show Badge
                    document.getElementById('vip-status-badge').classList.remove('hidden');
                }

                startGlobalTimer(session.expiresAt, session.isUnlimited);
                init();
            }, 500);
        }
        
        function applyAdminTheme() {
            // Change Badge
            const badge = document.querySelector('.vip-badge');
            if(badge) {
                badge.innerText = "SYSTEM ADMIN";
                badge.style.background = "linear-gradient(135deg, #ef4444 0%, #b91c1c 100%)";
                badge.style.webkitBackgroundClip = "text";
                badge.style.textShadow = "0 0 20px rgba(239, 68, 68, 0.5)";
            }

            // Change Status Dot
            const dot = document.getElementById('system-status-dot');
            if(dot) {
                dot.classList.remove('bg-amber-500', 'bg-green-500');
                dot.classList.add('bg-red-600');
            }
            const statusText = document.getElementById('system-status-text');
            if(statusText) {
                statusText.innerText = "Status: Root Access Granted";
                statusText.classList.remove('text-amber-400');
                statusText.classList.add('text-red-500');
            }

            // Change Header Timer Dot
            const timerDot = document.getElementById('timer-dot');
            if(timerDot) {
                timerDot.classList.remove('bg-amber-500');
                timerDot.classList.add('bg-red-500');
            }
        }

        function startGlobalTimer(expiresAt, isUnlimited) {
            const timerEl = document.getElementById('header-timer');
            const dot = document.getElementById('timer-dot');
            
            // STRICTER CHECK: Ensure isUnlimited is explicitly true
            if (isUnlimited === true && !isPreviewMode) {
                timerEl.innerText = "LIFETIME ∞";
                if (!document.querySelector('.vip-badge').innerText.includes("ADMIN")) {
                     dot.classList.add('bg-violet-400');
                }
                return;
            }

            if(isPreviewMode) {
                 timerEl.innerText = "PREVIEW MODE";
                 dot.classList.add('bg-yellow-500');
                 return;
            }

            if (countdownInterval) clearInterval(countdownInterval);

            updateTimer(); 

            countdownInterval = setInterval(updateTimer, 1000);

            function updateTimer() {
                const now = Date.now();
                // Safety check: if expiresAt is NaN or missing, force expire
                if (!expiresAt || isNaN(expiresAt)) {
                    clearInterval(countdownInterval);
                    timerEl.innerText = "ERROR";
                    return;
                }

                const diff = expiresAt - now;

                if (diff <= 0) {
                    clearInterval(countdownInterval);
                    timerEl.innerText = "SESSION EXPIRED";
                    localStorage.removeItem('kivro_premium_session');
                    setTimeout(() => window.location.reload(), 1000);
                    return;
                }

                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);

                timerEl.innerText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                
                if (diff < 3600000) dot.style.backgroundColor = '#f87171';
            }
        }
        
        // --- NEW: SESSION VERIFICATION POLLING ---
        function startSessionCheck(key) {
            if (sessionCheckInterval) clearInterval(sessionCheckInterval);
            
            // Check every 30 seconds
            sessionCheckInterval = setInterval(async () => {
                if(isPreviewMode) return;
                
                const deviceId = getDeviceId();
                try {
                    const response = await fetch(`${API_URL}?key=${encodeURIComponent(key)}&deviceId=${encodeURIComponent(deviceId)}&action=verify`);
                    const data = await response.json();
                    
                    // Handle explicit "valid: false"
                    if (data.valid === false) {
                        console.warn("Session invalid:", data.message);
                        localStorage.removeItem('kivro_premium_session');
                        alert(data.message || "Key expired or session terminated");
                        window.location.reload();
                    }
                } catch (e) {
                    console.error("Session check skipped due to network", e);
                }
            }, 30000); 
        }

        const gamesList = [
            { id: 5, title: "2048", category: "Puzzle", imgUrl: THUMB_BASE + "2048.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//2048/index.html" },
            { id: 7, title: "BTD4", category: "Strategy", imgUrl: THUMB_BASE + "BTD4.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//btd4/index.html" },
            { id: 6, title: "Bitlife", category: "Simulation", imgUrl: THUMB_BASE + "Bitlife.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//bitlife/index.html" },
            { id: 8, title: "Chess", category: "Strategy", imgUrl: THUMB_BASE + "chess.jpg", gameUrl: GITHUB_BASE + "chess/index.html" },
            { id: 9, title: "Cookie Clicker", category: "Clicker", imgUrl: THUMB_BASE + "Cookie-Clicker.jpg", gameUrl: GITHUB_BASE + "cookieclicker/index.html" },
            { id: 10, title: "Drive Mad", category: "Racing", imgUrl: THUMB_BASE + "Drive-Mad.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//drivemad/index.html" },
            { id: 2, title: "Flappy Bird", category: "Arcade", imgUrl: THUMB_BASE + "Flappy-Bird.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//flappybird/index.html" },
            { id: 3, title: "Geo Dash", category: "Rhythm", imgUrl: THUMB_BASE + "Geometry-Dash.webp", gameUrl: "https://geometryite.vercel.app/" },
            { id: 15, title: "Google Snake", category: "Arcade", imgUrl: THUMB_BASE + "Google-Snake.jpg", gameUrl: "https://raw.githack.com/KAYAZzz/kivro-library/main/Snake/index.html" },
            { id: 11, title: "Monkey Mart", category: "Simulation", imgUrl: THUMB_BASE + "Monkey-Mart.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//monkeymart/index.html" },
            { id: 12, title: "PacMan", category: "Arcade", imgUrl: THUMB_BASE + "Pacman.jpg", gameUrl: GITHUB_BASE + "pacman/index.html" },
            { id: 1, title: "Retro Bowl", category: "Sports", imgUrl: THUMB_BASE + "Retro-Ball.webp", gameUrl: GITHUB_BASE + "retrobowl/index.html" },
            { id: 14, title: "Slope", category: "Runner", imgUrl: THUMB_BASE + "slope.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//Slope/index.html" },
            { id: 16, title: "Snow Battle", category: "Action", imgUrl: THUMB_BASE + "Snow-Battle.png", gameUrl: GITHUB_BASE + "snowbattle/index.html" },
            { id: 17, title: "Stack", category: "Puzzle", imgUrl: THUMB_BASE + "Stack.webp", gameUrl: GITHUB_BASE + "stack/index.html" },
            { id: 4, title: "Drift Boss", category: "Racing", imgUrl: THUMB_BASE + "Drift1.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//DriftBoss/index.html" },
            { id: 18, title: "Subway Surfers", category: "Runner", imgUrl: THUMB_BASE + "Subway-Surfers.jpg", gameUrl: "https://raw.githack.com/testingherokuapp/subwaysurfer/main/index.html" },
            { id: 19, title: "Baldi's Basics", category: "Horror", imgUrl: THUMB_BASE + "BaldisBasics.webp", gameUrl: GITHUB_BASE + "baldisbasics/index.html" },
            { id: 20, title: "Dino Runner", category: "Arcade", imgUrl: THUMB_BASE + "Dino.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//chromedino/index.html" },
            { id: 21, title: "Stickman Hook", category: "Action", imgUrl: THUMB_BASE + "stickman-hook.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//StickmanHook/index.html" },
            { id: 23, title: "Block Blast", category: "Puzzle", imgUrl: THUMB_BASE + "block-blast.jpeg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//blockblast/index.html" },
            { id: 24, title: "Merge Rot", category: "Puzzle", imgUrl: THUMB_BASE + "merge-rot.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//MergeRot/index.html" },
            { id: 25, title: "Hole.io", category: "Action", imgUrl: THUMB_BASE + "Hole.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//HoleIO/index.html" },
            { id: 26, title: "Sausage Flip", category: "Fun", imgUrl: THUMB_BASE + "sausage-flip.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//sausage-flip/index.html" },
            { id: 27, title: "YoHoHo.io", category: "IO", imgUrl: THUMB_BASE + "Yohoho.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io/yohohoio/index.html" },
            { id: 28, title: "Mr.Bullet", category: "Puzzle", imgUrl: THUMB_BASE + "Bullet.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//MrBullet/index.html" },
            { id: 29, title: "Impossible Quiz", category: "Puzzle", imgUrl: THUMB_BASE + "Impossible.png", gameUrl: "https://raw.githack.com/selenite-cc/selenite-old/main/theimpossiblequiz/index.html" },
            { id: 30, title: "Paper.io", category: "IO", imgUrl: THUMB_BASE + "paper-io.png", gameUrl: GITHUB_BASE + "paperio/index.html" },
            { id: 31, title: "Hill Climb", category: "Racing", imgUrl: THUMB_BASE + "HillClimb.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//HillClimbRacing/index.html" },
            { id: 34, title: "Bottle Flip", category: "Skill", imgUrl: THUMB_BASE + "bottleflip.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//BottleFlip2/index.html" },
            { id: 35, title: "Penalty Kicks", category: "Sports", imgUrl: THUMB_BASE + "penalty.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//PenaltyKicks/index.html" },
            { id: 36, title: "Gun Spin", category: "Action", imgUrl: THUMB_BASE + "gunspin.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//Gunspin/index.html" },
            { id: 37, title: "SandBoxel", category: "Simulation", imgUrl: THUMB_BASE + "Sandboxel.png", gameUrl: "https://raw.githack.com/R74nCom/sandboxels/main/index.html" },
            { id: 38, title: "Ballistic", category: "Puzzle", imgUrl: THUMB_BASE + "ballistic.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//Ballistic/index.html" },
            { id: 39, title: "Stacktris", category: "Puzzle", imgUrl: THUMB_BASE + "stacktris.jpeg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//stacktris/index.html" },
            { id: 40, title: "Tomb of Mask", category: "Action", imgUrl: THUMB_BASE + "TofM.jpg", gameUrl: "https://raw.githack.com/HTML5GameArchive/gfiles/master/games/tombofthemask/index.html" },
            { id: 41, title: "Paper Plane", category: "Fun", imgUrl: THUMB_BASE + "Planef.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//PaperFlight1/index.html" },
            { id: 42, title: "Curve Rush", category: "Action", imgUrl: THUMB_BASE + "curve-rush.webp", gameUrl: "https://curverush.com/curve-rush.embed" },
            { id: 43, title: "Burrito Bison", category: "Action", imgUrl: THUMB_BASE + "Bb.png", gameUrl: "https://burrito-bison-cnm.vercel.app/" },
            { id: 43, title: "Golf Orbit", category: "Sports", imgUrl: THUMB_BASE + "golf-orbit.png", gameUrl: "https://golf-orbit-k8ue.vercel.app/" },
            { id: 44, title: "Ragdoll Archers", category: "Action", imgUrl: THUMB_BASE + "ragdoll-archers.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//Ragdoll-Archers/index.html" },
            { id: 45, title: "Helix Jump", category: "Arcade", imgUrl: THUMB_BASE + "HelixJ.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//helixjump/index.html" },
            { id: 46, title: "PolyTrack", category: "Racing", imgUrl: THUMB_BASE + "Polyt.webp", gameUrl: "https://raw.githack.com/AnonymousBirb5100/polytrack/main/index.html" },
            { id: 47, title: "Gobble", category: "Fun", imgUrl: THUMB_BASE + "Gobble.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//Gobble/gobble/index.html" },
            { id: 48, title: "Swingo", category: "Fun", imgUrl: THUMB_BASE + "swingo.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//Swingo/index.html" },
            { id: 49, title: "Spiral Roll", category: "Fun", imgUrl: THUMB_BASE + "Spiralr.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//spralr/index.html" },
            { id: 50, title: "Wordle", category: "Word", imgUrl: THUMB_BASE + "IMG_0829.jpeg", gameUrl: "https://wordle-actual.vercel.app" },
            { id: 51, title: "Unicycle Heroes", category: "Physics", imgUrl: THUMB_BASE + "IMG_0832.jpeg", gameUrl: "https://unicycleh.vercel.app" },
            { id: 52, title: "Sheep Sheep", category: "Puzzle", imgUrl: THUMB_BASE + "Sheep.jpeg", gameUrl: "https://ubgfun.github.io/puzzle/hell-tile/" },
            { id: 53, title: "Game In Game", category: "Meta", imgUrl: THUMB_BASE + "GameInsideGame.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//game-inside/index.html" },
            { id: 54, title: "Black Jack", category: "Card", imgUrl: THUMB_BASE + "Blackjack.png", gameUrl: "https://blackjack-self.vercel.app/" },
            { id: 55, title: "Raft Wars", category: "Action", imgUrl: THUMB_BASE + "Raftwars.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//raft-war/index.html" },
            { id: 56, title: "Small World Cup", category: "Sports", imgUrl: THUMB_BASE + "Asworldc.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//a-smallwc/index.html" },
            { id: 57, title: "BowMasters", category: "Action", imgUrl: THUMB_BASE + "IMG_0856.png", gameUrl: "https://wowksies-github-io-6e3122.gitlab.io///bowmasters/index.html" },
            { id: 58, title: "State.io", category: "Strategy", imgUrl: THUMB_BASE + "IMG_0862.png", gameUrl: "https://stateactual.vercel.app/rvvASMiM/1701b2232f8c4f7689394f229bda07d7/index.html" },
            { id: 59, title: "Day of Meat", category: "Defense", imgUrl: THUMB_BASE + "Deathofmeat.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//DayOfMeat/index.html" },
            { id: 60, title: "Knife Hit", category: "Skill", imgUrl: THUMB_BASE + "Knifehit.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//knifehit/index.html" },
            { id: 61, title: "Solar Smash", category: "Simulation", imgUrl: THUMB_BASE + "IMG_0868.png", gameUrl: "https://wowksies-github-io-6e3122.gitlab.io///solar-smash/index.html" },
            { id: 62, title: "Bridge Race", category: "Fun", imgUrl: THUMB_BASE + "IMG_0870.jpeg", gameUrl: "https://wowksies-github-io-6e3122.gitlab.io///bridge-race/index.html" },
            { id: 63, title: "Papa's Pizzeria", category: "Cooking", imgUrl: THUMB_BASE + "papaspiz.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//papsp/index.html" },
            { id: 64, title: "Little Alchemy", category: "Puzzle", imgUrl: THUMB_BASE + "littleA.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//little-alchemy/index.html" },
            { id: 65, title: "8 Ball Pool", category: "Sports", imgUrl: THUMB_BASE + "8ballpool.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//pool-pixijs/index.html" },
            { id: 66, title: "Stealth Master", category: "Action", imgUrl: THUMB_BASE + "stealthmaster.jpg", gameUrl: "https://wowksies-github-io-6e3122.gitlab.io///stealth-master/index.html" },
            { id: 67, title: "Hide and Seek", category: "Fun", imgUrl: THUMB_BASE + "hideandseek.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//hideandseek/8328750458724478102.playables.usercontent.goog/v/assets/index.html" },
            { id: 68, title: "Slice it All", category: "Fun", imgUrl: THUMB_BASE + "sliceitall.png", gameUrl: "https://wowksies-github-io-6e3122.gitlab.io///slice-it-all/index.html" },
            { id: 69, title: "Bus Out", category: "Puzzle", imgUrl: THUMB_BASE + "busout.webp", gameUrl: "https://gamesbun.github.io/busout-school/" },
            { id: 70, title: "Blumgi Racers", category: "Racing", imgUrl: THUMB_BASE + "br.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//blumgir/index.html" },
            { id: 71, title: "Hills Of Steel", category: "Action", imgUrl: THUMB_BASE + "hills%20of%20steel.webp", gameUrl: "https://hillofsteele.vercel.app/" },
            { id: 72, title: "Rooftop Snipers", category: "Action", imgUrl: THUMB_BASE + "rooftop-snipers.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//rooftopsnipers/index.html" },
            { id: 73, title: "Blumgi Ball", category: "Sports", imgUrl: THUMB_BASE + "blumgiball.webp", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//blumgiball/index.html" },
            { id: 74, title: "Draw Joust", category: "Action", imgUrl: THUMB_BASE + "IMG_0959.png", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//DrawJoustindex.html" },
            { id: 78, title: "Basket Legends", category: "Sports", imgUrl: THUMB_BASE + "IMG_0963.jpeg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//basketball-legends-main/index.html" },
            { id: 79, title: "Soccer Legends", category: "Sports", imgUrl: THUMB_BASE + "Football-Legends.jpg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io//football-legends/index.html" },
            { id: 76, title: "Crossy Road", category: "Fun", imgUrl: THUMB_BASE + "CrossyR.jpg", gameUrl: "https://wowksies-github-io-6e3122.gitlab.io///crossy-road/index.html" },
            { id: 77, title: "Getaway Shoot", category: "Action", imgUrl: THUMB_BASE + "IMG_0980.jpeg", gameUrl: "https://kivro-game-library-9d7913.gitlab.io/getaway-shootout/index.html" }
        ];

        const appsList = [
            { id: 1001, title: "BlackFlix", category: "App", gameUrl: "https://ixlgroupjam.lovable.app/", imgUrl: THUMB_BASE + "IMG_0988.jpeg" }
        ];

        let activeGamesList = gamesList;

        // --- APP LOGIC ---
        function init() {
            renderGrid(activeGamesList); // Use active list
            updateCount(activeGamesList.length);
            setupTabs();
            setupSearch();
            setupMobileMenu();
        }

        function renderGrid(items) {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';
            
            items.forEach((item, index) => {
                const isFav = favorites.includes(item.id);
                const card = document.createElement('div');
                card.className = "smooth-card group cursor-pointer animate-pop-in";
                card.style.animationDelay = `${index * 50}ms`; // Staggered animation

                // GUARDED ONCLICK
                card.onclick = () => {
                    if (isPreviewMode) {
                        showToast("🔒 Premium Required to Play");
                        document.getElementById('free-mode-cta').scrollIntoView({behavior: 'smooth', block: 'center'});
                        return;
                    }
                    window.open(item.gameUrl, '_blank');
                };

                card.innerHTML = `
                    <div class="h-36 sm:h-40 relative img-wrapper bg-black/50 m-2">
                        <img src="${item.imgUrl}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" onerror="this.src='https://placehold.co/400x250/111/444?text=NULL'">
                        
                        <div class="absolute bottom-2 left-2 flex items-center gap-2 bg-black/40 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/5">
                            <div class="status-dot"></div>
                            <span class="text-[10px] font-bold text-white/90 uppercase tracking-widest">Stable</span>
                        </div>
                    </div>
                    <div class="px-5 pb-5 pt-2 flex justify-between items-start">
                        <div>
                            <h3 class="text-sm font-bold text-zinc-100 truncate max-w-[120px]">${item.title}</h3>
                            <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-wide mt-0.5">${item.category}</p>
                        </div>
                        <button onclick="toggleFav(event, ${item.id})" class="text-zinc-600 hover:text-amber-400 transition-colors ${isFav ? 'text-amber-400' : ''}">
                            <svg class="w-5 h-5" fill="${isFav ? 'currentColor' : 'none'}" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // ... existing helper functions (copyBookmarklet, fallbackCopy, showToast) ...
        function copyBookmarklet() {
            if (isPreviewMode) {
                showToast("🔒 Premium Required to Copy");
                return;
            }

            if (navigator.clipboard) {
                navigator.clipboard.writeText(BOOKMARKLET_CODE).then(() => {
                    showToast("Bookmarklet Copied!");
                }).catch(() => {
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }
        }

        function fallbackCopy() {
            if (isPreviewMode) return;
            const el = document.createElement('textarea');
            el.value = BOOKMARKLET_CODE;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast("Bookmarklet Copied!");
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            const txt = document.getElementById('toast-msg');
            txt.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function setupTabs() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.onclick = () => {
                    // Check for Preview Mode restriction on Proxy and Menu
                    const target = btn.dataset.tab;
                    if (isPreviewMode && (target === 'Menu' || target === 'Proxy')) {
                        showToast("🔒 Premium Required");
                        const cta = document.getElementById('free-mode-cta');
                        if (cta) cta.scrollIntoView({behavior: 'smooth', block: 'center'});
                        return;
                    }

                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTab = target;
                    
                    if (currentTab === 'Proxy') {
                        window.open('https://kivroprox1.vercel.app', '_blank');
                        return;
                    }

                    // Handle View Switching
                    const grid = document.getElementById('game-grid');
                    const menuView = document.getElementById('menu-view');
                    const header = document.getElementById('dashboard-header');
                    const searchBar = document.getElementById('search-toggle');

                    if (currentTab === 'Menu') {
                        grid.classList.add('hidden');
                        header.classList.add('hidden');
                        menuView.classList.remove('hidden');
                        searchBar.classList.add('opacity-0', 'pointer-events-none');
                    } else {
                        grid.classList.remove('hidden');
                        header.classList.remove('hidden');
                        menuView.classList.add('hidden');
                        searchBar.classList.remove('opacity-0', 'pointer-events-none');
                        
                        // IMPORTANT: Pass current active list to filterGrid
                        filterGrid();
                    }
                    
                    document.getElementById('mobile-menu').classList.add('hidden');
                }
            });
        }

        function setupMobileMenu() {
            const trigger = document.getElementById('mobile-menu-trigger');
            const menu = document.getElementById('mobile-menu');
            if(trigger) {
                trigger.onclick = () => menu.classList.toggle('hidden');
            }
        }

        function setupSearch() {
            const toggle = document.getElementById('search-toggle');
            const bar = document.getElementById('search-bar');
            const input = document.getElementById('global-search');

            toggle.onclick = () => {
                bar.classList.toggle('hidden');
                if(!bar.classList.contains('hidden')) input.focus();
            };
            input.oninput = (e) => filterGrid(e.target.value);
        }

        function filterGrid(term = '') {
            const s = term.toLowerCase();
            
            // Use activeGamesList instead of raw lists to respect Free Mode limits
            const all = isPreviewMode ? activeGamesList : [...gamesList, ...appsList];
            
            const filtered = all.filter(item => {
                if(!item.title.toLowerCase().includes(s)) return false;
                if(currentTab === 'Favs') return favorites.includes(item.id);
                if(currentTab === 'Apps') return item.category === 'App';
                if(currentTab === 'Menu') return false; // Handled by view switching
                return item.category !== 'App'; // Default to Games
            });
            renderGrid(filtered);
            updateCount(filtered.length);
        }

        function updateCount(n) {
            document.getElementById('item-count').innerText = n || activeGamesList.length;
        }

        window.toggleFav = (e, id) => {
            e.stopPropagation();
            if(favorites.includes(id)) favorites = favorites.filter(x => x !== id);
            else favorites.push(id);
            localStorage.setItem('kivro_favs', JSON.stringify(favorites));
            filterGrid(); // Re-render to show correct fav status
        };

        // --- SESSION RESUME ---
        window.onload = () => {
             // 1. Session Resume Logic
             localStorage.removeItem('kivro_preview_session');
             const session = JSON.parse(localStorage.getItem('kivro_premium_session'));
             if (session) {
                 if (!session.isUnlimited && session.expiresAt < Date.now()) {
                     localStorage.removeItem('kivro_premium_session');
                 } else {
                     showVipWelcome(session);
                 }
             }

             // 2. Install Logic
             const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
             
             if (!isStandalone && !localStorage.getItem('kivro_install_dismissed')) {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                
                setTimeout(() => {
                    const installModal = document.getElementById('install-modal');
                    installModal.classList.remove('translate-y-full');
                    
                    if (isIOS) {
                        document.getElementById('ios-instructions').classList.remove('hidden');
                    } else if (deferredPrompt) {
                        document.getElementById('install-btn').classList.remove('hidden');
                    } else {
                        document.getElementById('manual-install').classList.remove('hidden');
                    }
                }, 2000); 
             }
        };

        document.getElementById('site-key-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') unlockSite();
        });
    </script>
</body>
</html>
