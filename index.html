<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kivro Games ‚Äì Play Free Unblocked Games Online</title>
<meta name="description" content="Kivro Games is your place to play free, fun, and unblocked browser games. Works on school iPads, desktops, and mobile devices.">
<meta name="keywords" content="Kivro Games, unblocked games, free online games, kivro, web games, school games, unblocked">
<meta name="robots" content="index, follow">
<meta name="google-adsense-account" content="ca-pub-8524021281977248">
<link rel="canonical" href="https://kivro-games.vercel.app/">

    <!-- --- Logo and Fullscreen Configuration --- -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kivro Games">
    
    <!-- Apple Touch Icon (for Add to Home Screen) -->
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/onsigma67.png">
    <!-- Standard Favicon -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png">
    <!-- --- End Logo Configuration --- -->

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter Font and Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
        }
        
        /* Plasma Background Concept */
        .plasma-background {
            background: radial-gradient(circle at 10% 20%, rgba(200, 20, 255, 0.1) 0%, rgba(0, 0, 0, 0) 70%),
                        radial-gradient(circle at 90% 80%, rgba(100, 0, 255, 0.1) 0%, rgba(0, 0, 0, 0) 70%),
                        #1a1a2e;
            background-size: 200% 200%;
            animation: movePlasma 40s ease-in-out infinite alternate;
        }

        @keyframes movePlasma {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* Shiny Text Concept */
        .shiny-text {
            background-image: linear-gradient(
                90deg,
                #6d28d9 0%,
                #f87171 20%,
                #a78bfa 40%,
                #f87171 60%,
                #6d28d9 80%
            );
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shine 4s linear infinite;
            display: inline-block;
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden;
            -webkit-line-clamp: 2;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: scale(0.97); }
          to { opacity: 1; transform: scale(1); }
        }

        .animate-fadeIn {
          animation: fadeIn 0.45s cubic-bezier(.2,.9,.2,1) both;
        }

        /* Intro specific */
        .intro {
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.03);
            box-shadow: 0 8px 30px rgba(20,12,40,0.6);
        }

        .logo-wrap img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            filter: drop-shadow(0 6px 18px rgba(100, 30, 150, 0.25));
        }

        /* Visible suggestions/updates panel */
        .side-panel {
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.03);
        }

        /* Nice thin scrollbar for game grid */
        #game-grid::-webkit-scrollbar {
          height: 10px;
        }
        #game-grid::-webkit-scrollbar-thumb {
          background: rgba(125, 85, 255, 0.18);
          border-radius: 10px;
        }
        /* Splash Intro */
#splash {
    background-color: rgba(26, 26, 46, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    inset: 0;
    z-index: 5000;
}

/* ------------------------------
   Splash: breathing logo + neon outline + chromatic title
   Paste this at the END of your existing <style> tag
   (remove any older breathe/textFade keyframes if present)
   ------------------------------ */

/* Breathing (scale + glow) for the logo */
@keyframes breathe {
  0% {
    transform: scale(1);
    filter: drop-shadow(0 0 10px rgba(120, 80, 255, 0.35));
  }
  50% {
    transform: scale(1.08);
    filter: drop-shadow(0 0 28px rgba(168, 85, 247, 0.9));
  }
  100% {
    transform: scale(1);
    filter: drop-shadow(0 0 10px rgba(120, 80, 255, 0.35));
  }
}

/* Neon outline pulse (uses outline + pseudo-element) */
.splash-logo {
  position: relative;
  display: inline-block;
  border-radius: 8px;
  will-change: transform, filter;
  animation: breathe 3.2s ease-in-out infinite;
}

/* Neon ring using pseudo element for glow outline that 'breathes' */
.splash-logo::after {
  content: "";
  position: absolute;
  inset: -8px;
  border-radius: 10px;
  pointer-events: none;
  z-index: -1;
  box-shadow: 0 0 18px rgba(167,139,250,0.35);
  transition: box-shadow 1.6s ease-in-out;
  animation: neonPulse 3.2s ease-in-out infinite;
  opacity: 0.95;
}

@keyframes neonPulse {
  0% { box-shadow: 0 0 10px rgba(100,80,255,0.25); transform: scale(1); }
  50% { box-shadow: 0 0 40px rgba(167,139,250,0.95); transform: scale(1.02); }
  100% { box-shadow: 0 0 10px rgba(100,80,255,0.25); transform: scale(1); }
}

/* Chromatic (shiny) text already exists on site as .shiny-text.
   We'll add a subtle breathing glow and slight scale so it matches */
.shiny-text {
  /* keep your gradient rules; add these extras */
  transition: text-shadow 0.9s ease, transform 0.9s ease;
  text-shadow: 0 0 8px rgba(167,139,250,0.25);
  display: inline-block;
  animation: textBreathe 3.2s ease-in-out infinite;
}

@keyframes textBreathe {
  0% { transform: translateY(0) scale(1); text-shadow: 0 0 6px rgba(167,139,250,0.18); }
  50% { transform: translateY(-3px) scale(1.02); text-shadow: 0 0 18px rgba(250,130,180,0.35); }
  100% { transform: translateY(0) scale(1); text-shadow: 0 0 6px rgba(167,139,250,0.18); }
}

/* Slide + fade-in for splash title text */
@keyframes textFade {
  0% { opacity: 0; transform: translateY(18px) scale(0.98); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

.animate-textFade {
  animation: textFade 1.05s cubic-bezier(.2,.9,.2,1) both;
  animation-delay: 0.35s; /* logo animates first */
}

/* Small responsive tweak so the text scales on small screens */
#splash h1 {
  font-size: clamp(1.8rem, 4.2vw, 3.6rem);
  line-height: 1;
  margin-top: 0.6rem;
}

/* Hide flash/jank if splash is removed by JS (smooth fade) */
#splash.fade-out {
  opacity: 0;
  transition: opacity 0.55s ease;
  pointer-events: none;
}

/* Landscape popup layout */
#install-popup {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

#install-popup.active {
  opacity: 1;
  pointer-events: auto;
}

#install-content {
  background: #1a1632;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 1rem;
  box-shadow: 0 0 30px rgba(120, 80, 255, 0.5);
  width: 85%;
  max-width: 1100px;
  color: #f1f1ff;
  text-align: center;
  padding: 24px 36px;
  animation: fadeInUp 0.5s ease both;
}

#install-content h2 {
  font-size: 1.8rem;
  color: #c084fc;
  margin-bottom: 8px;
}

#install-content p.intro {
  color: #d1d5db;
  font-size: 1rem;
  margin-bottom: 24px;
}

/* Steps horizontal layout */
.install-steps {
  display: flex;
  justify-content: space-around;
  align-items: start;
  gap: 28px;
  flex-wrap: nowrap;
}

.install-step {
  flex: 1;
  background: rgba(255,255,255,0.05);
  border-radius: 0.75rem;
  padding: 16px;
  border: 1px solid rgba(255,255,255,0.08);
  text-align: center;
}

.install-step .number {
  font-size: 1.6rem;
  font-weight: 800;
  color: #a78bfa;
}

.install-step p {
  font-size: 1rem;
  margin: 6px 0 12px 0;
  color: #d1d5db;
}

.install-step img {
  width: 100%;
  max-width: 240px;
  height: auto;
  border-radius: 0.5rem;
  border: 1px solid rgba(255,255,255,0.15);
  margin: 0 auto;
}

/* Close button */
#install-content button {
  background: #6d28d9;
  color: white;
  padding: 10px 24px;
  border-radius: 0.5rem;
  font-weight: 600;
  margin-top: 24px;
  transition: all 0.3s;
}

#install-content button:hover {
  background: #7c3aed;
  transform: scale(1.05);
}

/* Base popup container (shared) */
#install-popup {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

#install-popup.active {
  opacity: 1;
  pointer-events: auto;
}

/* Base popup box */
#install-content {
  background: #1a1a2e;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 1.25rem;
  box-shadow: 0 0 40px rgba(168, 85, 247, 0.3);
  color: #f3e8ff;
  text-align: center;
  padding: 32px;
  animation: fadeInUp 0.5s ease both;
}

/* Shared title and intro */
#install-content h2 {
  font-size: 2rem;
  color: #c084fc;
  margin-bottom: 10px;
  font-weight: 700;
}

#install-content p.intro {
  color: #d1d5db;
  font-size: 1.05rem;
  margin-bottom: 25px;
}

/* Step cards (base style) */
.install-step {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.07);
  border-radius: 1rem;
  padding: 16px 20px;
  color: #e0e0e0;
  font-size: 1rem;
}

/* ===== LANDSCAPE MODE ===== */
@media (orientation: landscape) {
  #install-content {
    width: 90vw;
    max-width: 1300px;
  }

  .install-steps {
    display: flex;
    justify-content: space-evenly;
    align-items: flex-start;
    gap: 40px;
  }

  .install-step {
    flex: 1;
    text-align: center;
  }

  .install-step img {
    margin-top: 12px;
    width: 100%;
    max-width: 280px;
    border-radius: 12px;
  }
}

/* ===== PORTRAIT MODE ===== */
@media (orientation: portrait) {
  #install-content {
    width: 92vw;
    max-width: 700px;
  }

  .install-steps {
    display: flex;
    flex-direction: column;
    gap: 22px;
  }

  .install-step {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .install-step img {
    width: 45%;
    border-radius: 10px;
  }

  .install-step p {
    width: 50%;
    text-align: left;
  }
}
        /* Make selected icon stand out */
.select-icon.border-indigo-400 {
  box-shadow: 0 0 20px rgba(99, 102, 241, 0.6), 0 0 10px rgba(99, 102, 241, 0.4);
  transform: scale(1.1);
  transition: all 0.25s ease-in-out;
}

/* Selected icon glow effect */
.select-icon.border-indigo-400 {
  box-shadow: 0 0 25px rgba(99, 102, 241, 0.9),
              0 0 40px rgba(99, 102, 241, 0.6),
              inset 0 0 10px rgba(99, 102, 241, 0.4);
  transform: scale(1.2);
  border-color: #818cf8;
  transition: all 0.3s ease;
}

@keyframes pulseGlow {
  0%, 100% { text-shadow: 0 0 6px rgba(99,102,241,0.6); }
  50% { text-shadow: 0 0 14px rgba(139,92,246,1); }
}
#clear-search {
  animation: pulseGlow 2s infinite ease-in-out;
}




    </style>
</head>
<body class="plasma-background min-h-screen text-gray-100 antialiased">

<style>
/* Styling for the full-screen ad overlay */
.ad-overlay {
    /* Initially hidden */
    display: none; 
    position: fixed;
    top: 0; left: 0;
    width: 100%; 
    height: 100%;
    background: rgba(0, 0, 0, 0.75); /* Dark, transparent background */
    backdrop-filter: blur(4px);
    z-index: 99999; /* Ensures it's on top of everything */
    /* Centering content using Flexbox */
    justify-content: center;
    align-items: center;
}

/* Class to make the overlay visible (toggled by JavaScript) */
.ad-overlay--visible {
    display: flex;
}

/* Update the content box to be wider for a better interstitial feel */
.ad-popup-content {
    background: purple;
    padding: 20px;
    border-radius: 10px;
    /* Increase max-width to allow a larger ad to fit */
    max-width: 900px; /* NEW: Allow it to take up most of the screen */
    width: 90%;
    text-align: center;
}

/* Update the ad container dimensions */
#ad-container {
    /* Use dimensions from the ad network or aim for a large interstitial size (e.g., 728x90 or 300x600) */
    width: 728px; /* Example: Use a common large banner size */
    height: 300px; /* Example height */
    margin: 10px auto 0; 
    overflow: hidden; 
}

#kivro-widget {
  position: fixed;
  top: 12px;
  left: 12px;
  padding: 10px 14px;
  background: linear-gradient(135deg, #9e3bff, #6a00ff);
  color: white;
  font-family: Arial, sans-serif;
  font-size: 13px;
  border-radius: 12px;
  z-index: 999999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,0.25);
}

#kivro-widget .kivro-title {
  font-weight: bold;
  margin-bottom: 4px;
  font-size: 14px;
  letter-spacing: 1px;
}


</style>

    
<!-- Splash Intro -->
<div id="splash" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-[5000]">
  <img 
    src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" 
    alt="CNM Games Logo" 
    class="w-32 h-32 animate-breath"
  >
  <h1 class="mt-6 text-5xl font-extrabold shiny-text opacity-0 animate-textFade">Kivro Games</h1>
</div>

    <!-- Header/Nav Bar -->
    <header class="bg-gray-900/80 backdrop-blur-sm shadow-2xl z-50 w-full">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5 flex flex-col md:flex-row justify-between items-start md:items-center">
            
            <!-- Title -->
            <div class="mb-4 md:mb-0 flex items-center">
                <svg class="w-10 h-10 mr-3 text-pink-400 transform -rotate-15" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    <circle cx="12" cy="12" r="8" stroke-width="2" />
                    <line x1="12" y1="8" x2="12" y2="12" stroke-width="2" />
                    <line x1="12" y1="12" x2="15" y2="15" stroke-width="2" />
                </svg>
                <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight">
                    <span class="shiny-text">Kivro Games</span>
                </h1>
            </div>

            <!-- User ID Display -->
            <p class="text-xs text-gray-400 mt-2 md:mt-0">User ID: <span id="user-id-display" class="font-mono text-purple-400 break-all">Authenticating...</span></p>

<!-- Search Input (replace existing block) -->
<div class="w-full md:w-80 lg:w-96 mt-4 md:mt-0">
  <div class="relative">
    <input 
      type="text" 
      id="search-input"
      placeholder="Search title or category..." 
      class="w-full py-3 pl-12 pr-10 border border-indigo-500/50 rounded-full focus:ring-4 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300 bg-gray-800 text-gray-50 placeholder-gray-400 shadow-xl"
    />
    <!-- Search Icon -->
    <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 h-6 w-6 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>

    <!-- Clear Button (X). Hidden by default. -->
<button 
  id="clear-search" 
  class="absolute right-4 top-1/2 transform -translate-y-1/2 hidden 
         text-indigo-400 hover:text-white focus:outline-none transition 
         duration-200 ease-in-out text-lg font-bold drop-shadow-[0_0_6px_rgba(99,102,241,0.8)] 
         hover:drop-shadow-[0_0_10px_rgba(139,92,246,0.9)]">
  ‚úï
</button>

  </div>
</div>


    </header>


    <!-- Intro + Side panels (Suggestions & Updates) -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        <!-- Intro -->
        <section id="intro" class="intro rounded-2xl p-6 animate-fadeIn max-w-7xl mx-auto flex flex-col md:flex-row items-center gap-6">
            <div class="logo-wrap flex items-center gap-4">
                <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Logoactual.png" alt="CNM Games Logo" class="rounded-lg" />
                <div>
                    <h2 class="text-3xl font-extrabold text-gray-100"><span class="shiny-text">Welcome to Kivro Games</span></h2>
                    <p class="text-gray-300 mt-1 max-w-2xl">Play free web games, save your progress, and explore new titles. Suggestions and updates are right here, so you don‚Äôt have to hunt through popups.</p>
                </div>
            </div>

            <!-- Suggestions + Updates side-by-side -->


                <div class="side-panel p-4 rounded-xl">
                    <h3 class="text-lg font-semibold text-purple-300 mb-2">üéÆ Game Suggestions</h3>
                    <div class="text-gray-300 text-sm space-y-1">
                        <ul class="list-disc list-inside ml-4">
                            <li>Want a game to be added?</li>
                            <li>‚ö†Ô∏èNiche Poki Games are harder to Pirate‚ö†Ô∏è</li>
                        </ul>
                        <a href="https://kivro-games.vercel.app/GameDisturtuionrules.md"
       class="block text-center bg-indigo-600 text-white py-2 px-4 rounded-md font-medium text-xs hover:bg-indigo-700 transition transform hover:scale-[1.03] shadow-sm">
        Game Suggetion Rules!
             Read First
    </a>
                         <a href="https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAO__TF_CsRUNkFLWEg2QzdFOE5EVVRKU0xaTk5aUlNIUi4u"
       class="block text-center bg-indigo-600 text-white py-3 rounded-lg font-semibold text-sm hover:bg-indigo-700 transition transform hover:scale-[1.03] shadow-md">
        Suggest a Game
    </a>
                    </div>
                </div>
            </div>
        </section>



                <div class="side-panel p-4 rounded-xl">
                    <h3 class="text-lg font-semibold text-purple-300 mb-2">üõ† Latest Updates</h3>
                    <div class="text-gray-300 text-sm space-y-1">
                        <p class="font-semibold text-gray-200">November 19, 2025</p>
                        <ul class="list-disc list-inside ml-4">
							<h2>‚ö°‚ö°Games Are Much Faster Now!‚ö°‚ö°</h2>
							<h2>Progress Now Saves!</h2></h2>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Games Counter -->
        <div class="mb-2 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h2 class="text-3xl font-bold text-gray-200">Total Games:</h2>
                <span id="game-count" class="text-pink-400 text-4xl font-extrabold tracking-tight">0</span>
            </div>
        </div>

        <!-- Game Grid Container -->
        <div id="game-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
            <!-- Game cards will be inserted here by JavaScript -->
        </div>
    </main>

    <!-- Panic Button (Fixed Position) -->
    <button 
        id="panic-button"
        class="fixed bottom-4 right-4 z-[2000] p-4 text-white bg-red-600 rounded-full shadow-2xl hover:bg-red-700 transition transform hover:scale-[1.05] focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-75 flex items-center space-x-2 font-bold text-lg"
        title="Quick Escape (Press ESC)"
    >
        <!-- Lightning Bolt Icon -->
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
        <span>PANIC</span>
    </button>
    
    <!-- Game Launch Modal (Hidden by default) -->
    <div id="game-modal" class="fixed inset-0 bg-gray-900 bg-opacity-95 items-center justify-center transition-opacity duration-300 hidden z-[1000]">
        <div id="modal-content" class="w-full h-full relative">
            <!-- Close Button -->
            <button 
                id="close-modal-btn"
                class="absolute top-0 right-0 z-50 bg-red-600 text-white p-3 m-2 rounded-full shadow-xl hover:bg-red-700 transition duration-150 transform hover:rotate-90"
                title="Close Game (Esc Key)"
            >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <!-- Loading/Timeout Overlay - Simplified -->
            <div id="loading-overlay" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center p-8 transition-opacity duration-300 z-40">
                <div id="loading-spinner" class="animate-spin rounded-full h-12 w-12 border-b-4 border-indigo-500 mb-4"></div>
                
                <p id="loading-text" class="text-xl text-gray-400">Loading external game...</p>
                
                <!-- Fallback link area, initially hidden on timeout -->
                <div id="link-fallback" class="hidden text-center mt-6 p-6 max-w-lg w-full rounded-xl bg-gray-800/50 shadow-2xl border-t-4 border-indigo-500">
                    <p class="text-sm text-gray-300 mb-4 font-semibold">The game didn't load inside the hub. This usually means the host site blocks embedding.</p>
                    <a id="open-in-new-tab" href="#" target="_blank" class="inline-block bg-indigo-600 text-white py-3 px-6 rounded-full font-semibold hover:bg-indigo-700 transition transform hover:scale-[1.05] shadow-lg">
                        Open Game in New Tab
                    </a>
                </div>
            </div>

            <!-- Game Iframe -->
            <iframe 
                id="game-iframe"
                src="" 
                class="w-full h-full shadow-2xl bg-gray-900" 
                title="Game Player"
                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
            ></iframe>

        </div>
    </div>

    <!-- NOTE: popup HTML removed because suggestions/updates are visible above -->

    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, getDoc, setDoc, serverTimestamp, setLogLevel 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Global Firebase & State Vars ---
        let db;
        let auth;
        let userId = 'loading'; 
        let currentGameId = null; 

        // Environment variables for Firebase config
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // --- Game Data (FIXED TO USE ABSOLUTE GITHUB RAW PATHS) ---
        const GITHUB_BASE_URL = "https://raw.githack.com/HTML5GameArchive/gfiles/master/games/";
        const THUMBNAILS_DIR = "https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Thumbnails/";

        const initialGames = [
            { id: 5, title: "2048", description: "Slide and merge numbered tiles on a grid to create the 2048 tile.", category: "Puzzle", gameUrl: "https://wowksies.github.io/kivro-Game-Library/2048/index.html", imgUrl: THUMBNAILS_DIR + "2048.png" },
            { id: 7, title: "BTD4", description: "Bloons TD 4: strategically place towers to defend against waves of colorful balloons.", category: "Tower Defense", gameUrl: "https://wowksies.github.io/kivro-Game-Library/btd4/index.html", imgUrl: THUMBNAILS_DIR + "BTD4.jpg" },
            { id: 6, title: "Bitlife", description: "Live a virtual life simulation, making choices that determine your career, relationships, and death.", category: "Simulation", gameUrl: "https://wowksies.github.io/kivro-Game-Library/bitlife/index.html", imgUrl: THUMBNAILS_DIR + "Bitlife.webp" },
            { id: 8, title: "Chess", description: "The classic board game of strategy and tactics. Outwit your opponent to deliver checkmate.", category: "Strategy", gameUrl: GITHUB_BASE_URL + "chess/index.html", imgUrl: THUMBNAILS_DIR + "chess.jpg" }, 
            { id: 9, title: "Cookie Clicker", description: "A highly addictive incremental game where you click a cookie to generate more cookies.", category: "Idle Clicker", gameUrl: GITHUB_BASE_URL + "cookieclicker/index.html", imgUrl: THUMBNAILS_DIR + "Cookie-Clicker.jpg" }, 
            { id: 10, title: "Drive Mad", description: "Drive huge monster trucks and try not to flip over in this physics-based driving game.", category: "Racing", gameUrl: "https://wowksies.github.io/kivro-Game-Library/drivemad/index.html", imgUrl: THUMBNAILS_DIR + "Drive-Mad.jpg" }, 
            { id: 2, title: "Flappy Bird", description: "Test your skill and patience by tapping to guide the bird through the challenging pipes.", category: "Arcade", gameUrl: "https://wowksies.github.io/kivro-Game-Library/flappybird/index.html", imgUrl: THUMBNAILS_DIR + "Flappy-Bird.jpg" }, 
            { id: 3, title: "Geo Dash", description: "Jump and fly your way through geometric worlds, synced to an electrifying beat.", category: "Rhythm", gameUrl: "https://geometryite.vercel.app/", imgUrl: THUMBNAILS_DIR + "Geometry-Dash.webp" }, 
            { id: 15, title: "Google Snake", description: "The classic arcade Snake game with a clean, modern twist. Eat apples and grow long!", category: "Arcade", gameUrl: "https://raw.githack.com/KAYAZzz/kivro-library/main/Snake/index.html", imgUrl: THUMBNAILS_DIR + "Google-Snake.jpg" }, 
            { id: 11, title: "Monkey Mart", description: "Run your own supermarket with the help of busy monkeys! Harvest and stock shelves.", category: "Simulation", gameUrl: "https://wowksies.github.io/kivro-Game-Library/monkeymart/index.html", imgUrl: THUMBNAILS_DIR + "Monkey-Mart.jpg" }, 
            { id: 12, title: "PacMan", description: "The arcade classic! Eat all the dots, avoid the ghosts, and grab the power pellets.", category: "Arcade", gameUrl: GITHUB_BASE_URL + "pacman/index.html", imgUrl: THUMBNAILS_DIR + "Pacman.jpg" }, 
            { id: 1, title: "Retro Ball", description: "Manage your American football team and call the shots on the field in glorious 8-bit style.", category: "Sports", gameUrl: GITHUB_BASE_URL + "retrobowl/index.html", imgUrl: THUMBNAILS_DIR + "Retro-Ball.webp" }, 
            { id: 14, title: "Slope", description: "Navigate a steep, endless slope, avoiding obstacles and trying to stay on the track.", category: "Endless Runner", gameUrl: "https://wowksies.github.io/kivro-Game-Library/Slope/index.html", imgUrl: THUMBNAILS_DIR + "slope.png" }, 
            { id: 16, title: "Snow Battle", description: "Throw snowballs at your enemies and duck behind cover in this fun, tactical winter battle game.", category: "Arcade", gameUrl: GITHUB_BASE_URL + "snowbattle/index.html", imgUrl: THUMBNAILS_DIR + "Snow-Battle.png" }, 
            { id: 17, title: "Stack", description: "A fast-paced reflex game where you try to stack blocks perfectly to build the tallest tower.", category: "Puzzle", gameUrl: GITHUB_BASE_URL + "stack/index.html", imgUrl: THUMBNAILS_DIR + "Stack.webp" },
            { id: 4, title: "Drift Boss", description: "Drift!", category: "Racing", gameUrl: "https://wowksies.github.io/kivro-Game-Library/DriftBoss/index.html", imgUrl: THUMBNAILS_DIR + "Drift1.jpg" },
            { 
                id: 18, 
                title: "Subway Surfers", 
                description: "Hosted externally. May require opening in a new tab.", 
                category: "Endless Runner", 
                gameUrl: "https://raw.githack.com/testingherokuapp/subwaysurfer/main/index.html", 
                imgUrl: THUMBNAILS_DIR + "Subway-Surfers.jpg" 
            },
            // --- NEW GAMES ADDED BELOW ---
            { id: 19, title: "Baldi's Basics", description: "Collect notebooks while avoiding the terrifying teacher, Baldi, in this survival horror parody.", category: "Horror/Educational", gameUrl: GITHUB_BASE_URL + "baldisbasics/index.html", imgUrl: THUMBNAILS_DIR + "BaldisBasics.webp" },
            { 
                id: 20, 
                title: "Dino Runner", 
                description: "The classic offline runner. Jump over cacti and duck under pterodactyls to survive.", 
                category: "Endless Runner", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/chromedino/index.html", // UPDATED URL
                imgUrl: THUMBNAILS_DIR + "Dino.jpg" 
            },
            { 
                id: 21, 
                title: "Stickman Hook", 
                description: "Swing like Spider-Man using your hook to navigate levels without falling.", 
                category: "Arcade/Physics", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/StickmanHook/index.html", 
                imgUrl: THUMBNAILS_DIR + "stickman-hook.png" 
            },
            { 
                id: 23, 
                title: "Block Blast", 
                description: "Drag and drop colorful blocks to complete lines and squares in this challenging puzzle game.", 
                category: "Puzzle", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/blockblast/index.html", 
                imgUrl: THUMBNAILS_DIR + "block-blast.jpeg" 
            },
            { 
                id: 24, 
                title: "Merge Rot", 
                description: "Merge rotating blocks and achieve the highest score in this spatial puzzle challenge.", 
                category: "Puzzle", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/MergeRot/index.html", 
                imgUrl: THUMBNAILS_DIR + "merge-rot.png" // Updated to use the provided thumbnail
            },
            { 
                id: 25, 
                title: "Hole.io", 
                description: "Gobble Up The City and Players Around you to be Victorious!", 
                category: "Arcade", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/HoleIO/index.html", 
                imgUrl: THUMBNAILS_DIR + "Hole.png" // Updated to use the provided thumbnail
            },
            {
                id: 26, 
                title: "Sausage Flip", 
                description: "Flip the Sausage of the pan to get to the Finish Line!", 
                category: "Arcade/Physics", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/sausage-flip/index.html", 
                imgUrl: THUMBNAILS_DIR + "sausage-flip.png" // Updated to use the provided thumbnail
            },
            {
                id: 27, 
                title: "YoHoHo.io", 
                description: "A battle Royale Amongst Pirates on Your Island", 
                category: "Battle Royale", 
                gameUrl: "https://wowksies.github.io/yohohoio/index.html", 
                imgUrl: THUMBNAILS_DIR + "Yohoho.jpg" // Updated to use the provided thumbnail
            },
            {
                id: 28, 
                title: "Mr.Bullet", 
                description: "Assassinate Criminals around You using your Pistol", 
                category: "Puzzle", 
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/MrBullet/index.html", 
                imgUrl: THUMBNAILS_DIR + "Bullet.jpg" // Updated to use the provided thumbnail
            },
            {
                id: 29, 
                title: "The Impossible Quiz", 
                description: "Solve Questions In this Quiz to see how Smart You really are!", 
                category: "Puzzle", 
                gameUrl: "https://raw.githack.com/selenite-cc/selenite-old/main/theimpossiblequiz/index.html", 
                imgUrl: THUMBNAILS_DIR + "Impossible.png" // Updated to use the provided thumbnail
            },
            {
                id: 30,
                title: "Paper.io",
                description: "Claim territory and surround opponents in this addictive multiplayer strategy game.",
                category: "Strategy/IO",
                gameUrl: GITHUB_BASE_URL + "paperio/index.html",
                imgUrl: THUMBNAILS_DIR + "paper-io.png"
            },
            {
                id: 31,
                title: "Hill Climb Racing",
                description: "Drive across hilly terrain, collect coins, and avoid flipping your vehicle.",
                category: "Racing",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/HillClimbRacing/index.html",
                imgUrl: THUMBNAILS_DIR + "HillClimb.png"
            },
            {
                id: 34,
                title: "Bottle Flip",
                description: "Flip the bottle perfectly onto platforms and test your timing and skill.",
                category: "Skill/Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/BottleFlip2/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/bottleflip.png"
            },
            {
                id: 35,
                title: "Penalty Kicks",
                description: "Score goals and defend shots in this fast-paced soccer penalty shootout game.",
                category: "Sports",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/PenaltyKicks/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/penalty.jpg"
            },
            {
                id: 36,
                title: "Gun Spin",
                description: "Score goals and defend shots in this fast-paced soccer penalty shootout game.",
                category: "Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/Gunspin/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/gunspin.png"
            },
            {
                id: 37,
                title: "SandBoxel",
                description: "Create, destroy, and experiment with different materials in a physics-based sandbox world.",
                category: "Simulation",
                gameUrl: "https://raw.githack.com/R74nCom/sandboxels/main/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Sandboxel.png"
            },
            {
                id: 38,
                title: "Ballistic",
                description: "Aim and shoot volleys of balls to smash numbered bricks ‚Äî don‚Äôt let the stack reach the bottom.",
                category: "Puzzle",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/Ballistic/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/ballistic.png"
            },
            {
                id: 39,
                title: "Stacktris",
                description: "Stack spinning blocks to build the tallest tower without letting it fall.",
                category: "Arcade/Puzzle",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/stacktris/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/stacktris.jpeg"
            },
            {
                id: 40,
                title: "Tomb Of The Mask",
                description: "Climb walls and race through fast vertical mazes, collecting coins and avoiding traps.",
                category: "Arcade/Puzzle",
                gameUrl: "https://raw.githack.com/HTML5GameArchive/gfiles/master/games/tombofthemask/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/TofM.jpg"
            },
            {
                id: 41,
                title: "Paper Plane",
                description: "Fly your paper plane as far as possible, dodging obstacles and performing stunts.",
                category: "Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/PaperFlight1/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Planef.jpg"
            },
            {
                id: 42,
                title: "Curve Rush",
                description: "Guide your ball along twisting tracks at high speed without falling off.",
                category: "Arcade",
                gameUrl: "https://curverush.com/curve-rush.embed",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/curve-rush.webp"
            },
            {
                id: 43,
                title: "Burrito Bison",
                description: "Launch yourself through the air, smash gummies, and upgrade to fly even farther.",
                category: "Action / Arcade",
                gameUrl: "https://burrito-bison-cnm.vercel.app/",
                imgUrl: "https://raw.githack.com/KAYAZzz/cnm-games.github.io/main/Thumbnails/Bb.png"
            },
            {
                id: 43,
                title: "Golf Orbit",
                description: "Launch golf balls into orbit and see how far across the planet you can hit them.",
                category: "Sports / Arcade",
                gameUrl: "https://golf-orbit-k8ue.vercel.app/",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/golf-orbit.png"
            },
            {
                id: 44,
                title: "Ragdoll Archers",
                description: "Aim and shoot arrows in ragdoll physics battles against opponents.",
                category: "Action / Physics",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/Ragdoll-Archers/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/ragdoll-archers.jpg"
            },
            {
                id: 45,
                title: "Helix Jump",
                description: "Bounce a ball down a twisting helix tower while avoiding the colored traps",
                category: "Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/helixjump/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/HelixJ.webp"
            },
            {
                id: 46,
                title: "PolyTrack",
                description: "Race through vibrant low-poly tracks and compete for the fastest time.",
                category: "Racing",
                gameUrl: "https://raw.githack.com/AnonymousBirb5100/polytrack/main/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Polyt.webp"
            },
            {
                id: 47,
                title: "Gobble",
                description: "Eat smaller objects to grow bigger while avoiding anything larger than you",
                category: "Arcade / IO",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/Gobble/gobble/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Gobble.png"
            },
            {
                id: 48,
                title: "Swingo",
                description: "Swing and bounce through colorful levels using a stretchy grappling hook.",
                category: "Arcade / Platformer",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/Swingo/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/swingo.jpg"
            },
            {
                id: 49,
                title: "Spiral Roll",
                description: "Carve wood to create spirals that clear obstacles and earn points.",
                category: "Arcade / Skill",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/spralr/index.html",
                imgUrl: "https://raw.githack.com/KAYAZzz/cnm-games.github.io/main/Thumbnails/Spiralr.png"
            },
            {
                id: 50,
                title: "Wordle",
                description: "Word puzzle game where players have six tries to guess a hidden five-letter word using color-coded clues",
                category: "Puzzle",
                gameUrl: "https://wordle-actual.vercel.app",
                imgUrl: "https://raw.githack.com/KAYAZzz/cnm-games.github.io/main/Thumbnails/IMG_0829.jpeg"
            },
            {
                id: 51,
                title: "Unicycle Heroes",
                description: "Unicycle Hero is a physics-based sports game where you balance on a unicycle and compete in throwing events.",
                category: "Physics",
                gameUrl: "https://unicycleh.vercel.app",
                imgUrl: "https://raw.githack.com/KAYAZzz/cnm-games.github.io/main/Thumbnails/IMG_0832.jpeg"
            },
            {
                id: 52,
                title: "Sheep Sheep",
                description: "Match and collect adorable sheep in this relaxing puzzle game.",
                category: "Puzzle",
                gameUrl: "https://ubgfun.github.io/puzzle/hell-tile/",
                imgUrl: "https://raw.githack.com/KAYAZzz/cnm-games.github.io/main/Thumbnails/Sheep.jpeg"
            },
            {
                id: 53,
                title: "Game Inside Game",
                description: "Play a series of mini-games that appear within each other in a fun, layered challenge.",
                category: "Arcade / Puzzle",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/game-inside/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/GameInsideGame.png"
            },
            {
                id: 54,
                title: "Black Jack",
                description: "Try to beat the dealer by getting as close to 21 as possible without going over.",
                category: "Card / Casino",
                gameUrl: "https://blackjack-self.vercel.app/",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Blackjack.png"
            },
            {
                id: 55,
                title: "Raft Wars",
                description: "Fire tennis balls at enemies to protect your treasure in this fun, turn-based water battle.",
                category: "Action / Strategy",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/raft-war/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Raftwars.jpg"
            },
            {
                id: 56,
                title: "Small World Cup",
                description: "Control tiny soccer teams and compete in a fun, fast-paced world cup tournament.",
                category: "Sports / Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/a-smallwc/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Asworldc.jpg"
            },
            {
                id: 57,
                title: "BowMasters",
                description: "Bowmasters is a colorful, physics-based action game where players take turns aiming and shooting at opponents using various weapons and characters.",
                category: "Action / Arcade",
                gameUrl: "https://wowksies.github.io//bowmasters/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/IMG_0856.png"
            }, 
            {
                id: 58,
                title: "State.io",
                description: "State.io is a fast-paced strategy game where you capture territories and conquer opponents to dominate the map.",
                category: "Strategy / IO",
                gameUrl: "https://stateactual.vercel.app/rvvASMiM/1701b2232f8c4f7689394f229bda07d7/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/IMG_0862.png"
            },
            {
                id: 59,
                title: "Day of Meat",
                description: "Defend your base from waves of mutated creatures using powerful weapons and upgrades.",
                category: "Action / Defense",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/DayOfMeat/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Deathofmeat.jpg"
            },
            {
                id: 60,
                title: "Knife Hit",
                description: "Throw knives to break spinning logs while avoiding hitting your own blades.",
                category: "Arcade / Skill",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/knifehit/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Knifehit.png"
            },
            {
                id: 61,
                title: "Solar Smash",
                description: "Solar Smash is a planet destruction simulator where players use powerful weapons‚Äîlike lasers, asteroids, and black holes‚Äîto obliterate worlds in spectacular fashion.",
                category: "Simulation",
                gameUrl: "https://wowksies.github.io//solar-smash/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/IMG_0868.png"
            },
            {
                id: 62,
                title: "Bridge race",
                description: "Bridge Race is a fun casual racing game where players collect bricks to build bridges and reach the finish line before opponents.",
                category: "Casual / Arcade",
                gameUrl: "https://wowksies.github.io//bridge-race/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/IMG_0870.jpeg"
            },
            {
                id: 63,
                title: "Papas Pizzaria",
                description: "Take orders, bake pizzas, and manage the shop to keep customers happy.",
                category: "Cooking / Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/papsp/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/papaspiz.webp"
            },
            {
                id: 64,
                title: "Little Alchemy",
                description: "Combine basic elements to create new items and discover hundreds of unique combinations.",
                category: "Puzzle / Creativity",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/little-alchemy/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/littleA.png"
            },
			{
                id: 65,
                title: "8 Ball Pool",
                description: "Line up your shots and sink balls in competitive online billiards matches.",
                category: "Sports / Pool",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/pool-pixijs/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/8ballpool.webp"
            },
			{
                id: 66,
                title: "Stealth Master",
                description: "Sneak through levels, defeat enemies, and complete missions without being detected.",
                category: "Action / Stealth",
                gameUrl: "https://wowksies.github.io//stealth-master/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/stealthmaster.jpg"
            },
			{
                id: 67,
                title: "Hide and Seek",
                description: "Run, hide, or chase as you play a fast-paced game of hiding and finding opponents.",
                category: "Arcade / Casual",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/hideandseek/8328750458724478102.playables.usercontent.goog/v/assets/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/hideandseek.webp"
            },
			{
                id: 68,
                title: "Slice it All",
                description: "Flip your blade and slice through obstacles while keeping your momentum.",
                category: "Arcade / Skill",
                gameUrl: "https://wowksies.github.io//slice-it-all/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/sliceitall.png"
            },
			{
                id: 69,
                title: "Bus Out",
                description: "Drive your bus through challenging routes, avoiding crashes and picking up passengers",
                category: "Driving / Simulation",
                gameUrl: "https://gamesbun.github.io/busout-school/",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/busout.webp"
            },
			{
                id: 70,
                title: "Blumgi Racers",
                description: "Use slingshot physics to launch your racer across tricky tracks and reach the finish line.",
                category: "Racing / Physics",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/blumgir/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/br.webp"
            },
			{
                id: 71,
                title: "Hills Of Steel",
                description: "Drive a tank over hills, shoot enemies, and collect loot to upgrade your firepower.",
                category: "Action / Vehicle Combat",
                gameUrl: "https://hillofsteele.vercel.app/",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/hills%20of%20steel.webp"
            },
			{
                id: 72,
                title: "Rooftop Snipers 2",
                description: "Duel atop rooftops using wild weapons and knock your opponent off to win.",
                category: "Action / Shooter",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/rooftopsnipers/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/rooftop-snipers.webp"
            },
			{
                id: 72,
                title: "Bounce Masters",
                description: "Bounce your way through levels, defeat enemies, and collect coins to upgrade.",
                category: "Arcade / Action",
                gameUrl: "https://wowksies.github.io//bouncemasters/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/bouncemasters.webp"
            },
			{
                id: 73,
                title: "Blumgi Ball",
                description: "Use a slingshot to launch the ball and teleport through obstacles to score.",
                category: "Arcade / Physics",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/blumgiball/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/blumgiball.webp"
            },
			{
                id: 74,
                title: "Draw Joust",
                description: "Draw Joust is a mobile action game where you draw a vehicle with weapons and battle opponents using physics-based combat.",
                category: "Action / Physics",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/DrawJoustindex.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/IMG_0959.png"
            },
			{
                id: 74,
                title: "Basketball Legends",
                description: "Basketball legends are iconic players known for their exceptional skill and lasting impact on the sport. They inspire fans and shape the history of basketball.",
                category: "Sports",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/basketball-legends-main/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/IMG_0963.jpeg"
            },
			{
                id: 75,
                title: "Football Legends",
                description: "Play fast-paced soccer matches using special moves and powerful shots to outscore opponents.",
                category: "Sports / Arcade",
                gameUrl: "https://wowksies.github.io/kivro-Game-Library/football-legends/index.html",
                imgUrl: "https://wowksies.github.io/kivro-games/Thumbnails/Football-Legends.jpg"
            },



			
        ];

        // --- DOM Elements ---
        const gameGrid = document.getElementById('game-grid');
        const searchInput = document.getElementById('search-input');
        const gameCountDisplay = document.getElementById('game-count');
        const userIdDisplay = document.getElementById('user-id-display'); 
        const gameModal = document.getElementById('game-modal');
        const gameIframe = document.getElementById('game-iframe');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const panicButton = document.getElementById('panic-button'); 

        // Modal Elements for Iframe Games
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingSpinner = document.getElementById('loading-spinner');
        const loadingText = document.getElementById('loading-text');
        const linkFallback = document.getElementById('link-fallback');
        const openInNewTabLink = document.getElementById('open-in-new-tab');

        // --- State ---
        let searchTerm = '';
        let loadTimeout;
        const PANIC_URL = "https://member.foodvillage.ie/login"; 

        // =========================================================================
        // === UTILITY FUNCTIONS ===================================================
        // =========================================================================

        /**
         * Redirects the user to the panic URL immediately.
         */
        function handlePanic() {
            console.warn("PANIC TRIGGERED. Redirecting to safe URL...");
            window.location.href = PANIC_URL;
        }


        // =========================================================================
        // === FIREBASE INITIALIZATION & DATA SAVING LOGIC =========================
        // =========================================================================

        /**
         * Initializes Firebase and authenticates the user, guaranteeing a defined userId.
         */
        async function initializeFirebase() {
            if (Object.keys(firebaseConfig).length === 0) {
                 console.warn("Firebase config is empty. Data persistence disabled.");
                 userId = crypto.randomUUID(); 
                 userIdDisplay.textContent = userId + " (Persistence Disabled)";
                 return;
            }
            
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                setLogLevel('debug'); 
                
                await new Promise((resolve) => {
                    const unsubscribe = onAuthStateChanged(auth, async (user) => {
                        if (!user) {
                            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        }
                        
                        userId = auth.currentUser?.uid || crypto.randomUUID();
                        userIdDisplay.textContent = userId;
                        console.log(`Firebase Initialized. User ID: ${userId}`);
                        
                        unsubscribe();
                        resolve();
                    });
                });

            } catch (error) {
                console.error("Error initializing Firebase or during sign-in:", error);
                userId = crypto.randomUUID(); 
                userIdDisplay.textContent = `Auth Failed: ${userId.substring(0, 8)}... (No Persistence)`;
            }
        }

        /**
         * Constructs the Firestore document path for game progress.
         */
        function getGameDocRef(gameId) {
            if (!db || !userId || !gameId) {
                console.error("Cannot get doc ref: Firebase or IDs missing.");
                return null;
            }
            // Path: /artifacts/{appId}/users/{userId}/game_saves/{gameId}
            const path = `/artifacts/${appId}/users/${userId}/game_saves`;
            return doc(db, path, String(gameId));
        }

        /**
         * Saves game data to Firestore (Called by postMessage listener).
         */
        async function saveGameProgress(gameId, data) {
            const docRef = getGameDocRef(gameId);
            if (!docRef) {
                console.warn(`[Save Skipped] Persistence is disabled. Game ID: ${gameId}`);
                return { success: false, error: "Persistence disabled." };
            }
            
            try {
                await setDoc(docRef, { 
                    gameId: String(gameId), 
                    timestamp: serverTimestamp(),
                    data: JSON.stringify(data) 
                });
                console.log(`[Save Success] Progress saved for ID ${gameId}.`);
                return { success: true };
            } catch (error) {
                console.error(`[Save Error] Error saving progress for ${gameId}:`, error);
                return { success: false, error: error.message };
            }
        }

        /**
         * Loads game data from Firestore (Called by postMessage listener).
         */
        async function loadGameProgress(gameId) {
            const docRef = getGameDocRef(gameId);
            if (!docRef) {
                 return { data: null, success: false, error: "Persistence disabled." };
            }

            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const { data } = docSnap.data();
                    const loadedData = JSON.parse(data);
                    console.log(`[Load Success] Progress loaded for ID ${gameId}.`);
                    return { data: loadedData, success: true };
                } else {
                    console.log(`[Load Info] No saved data found for ID ${gameId}.`);
                    return { data: null, success: true };
                }
            } catch (error) {
                console.error(`[Load Error] Error loading progress for ${gameId}:`, error);
                return { data: null, success: false, error: error.message };
            }
        }

        /**
         * PostMessage listener to handle SAVE/LOAD requests from the iframe.
         */
        function handleIframeMessage(event) {
            // Only accept messages from the currently active iframe source
            if (event.source !== gameIframe.contentWindow) {
                return; 
            }
            
            const message = event.data;
            const iframeWindow = gameIframe.contentWindow;

            if (typeof message !== 'object' || !message.type || message.gameId !== currentGameId) {
                return; 
            }

            switch (message.type) {
                case 'LOAD_DATA':
                    loadGameProgress(message.gameId).then(result => {
                        iframeWindow.postMessage({ type: 'LOAD_RESPONSE', data: result.data }, '*');
                    });
                    break;
                case 'SAVE_DATA':
                    saveGameProgress(message.gameId, message.payload).then(result => {
                        iframeWindow.postMessage({ type: 'SAVE_RESPONSE', success: result.success }, '*');
                    });
                    break;
                default:
                    break;
            }
        }

        // =========================================================================
        // === UI AND GAME LAUNCH LOGIC ============================================
        // =========================================================================

        /**
         * Opens the game modal with the specified URL and ID.
         */
// üöÄ OPEN GAME IN NEW WEBSITE ‚Äî NO MODAL, NO IFRAME
window.openGameModal = function (url, gameId) {
	
    // Ignore modal completely ‚Äî just redirect
    window.location.href = url;
	fetch(`https://kivro-counter.vercel.app/api/trackGame?gameId=${game.id}`);
};


        function closeGameModal() {
            clearTimeout(loadTimeout);
            gameIframe.onload = null;
            
            gameModal.classList.add('hidden');
            gameModal.classList.remove('flex');
            gameIframe.src = ''; // Stop the iframe content
            currentGameId = null; // Clear game context
        }

        /**
         * Simulates the count-up text animation.
         */
        function countUp(targetElement, finalNumber) {
            let count = 0;
            const duration = 1000;
            const interval = 30;
            const totalSteps = duration / interval;
            const increment = finalNumber === 0 ? 0 : finalNumber / totalSteps; 

            function updateCount() {
                if (count < finalNumber) {
                    count += increment;
                    targetElement.textContent = Math.ceil(count);
                    setTimeout(updateCount, interval);
                } else {
                    targetElement.textContent = finalNumber;
                }
            }
            if (targetElement.dataset.interval) {
                 clearTimeout(targetElement.dataset.interval);
            }
            targetElement.dataset.interval = setTimeout(updateCount, interval);
        }

        /**
         * Generates the HTML string for a single game card.
         */
        function createGameCardHTML(game) {
            const safeUrl = game.gameUrl.replace(/'/g, "\\'");
            
            return `
                <div 
                    class="bg-gray-800 rounded-xl shadow-xl overflow-hidden cursor-pointer transform transition duration-300 hover:scale-[1.03] hover:shadow-2xl hover:shadow-indigo-500/50"
                    data-url="${game.gameUrl}"
                    onclick="showAdThenPlay('${safeUrl}')"
                >
                    <!-- Thumbnail Area -->
                    <div class="h-40 bg-gray-900 relative overflow-hidden">
                        <img 
                            src="${game.imgUrl}" 
                            alt="${game.title} Thumbnail" 
                            class="w-full h-full object-cover transition-transform duration-500 ease-in-out hover:scale-110" 
                            onerror="this.onerror=null; this.src='https://placehold.co/400x220/DC2626/ffffff?text=Image+Load+FAIL+CHECK+CONSOLE';"
                        />
                        <!-- Category tag -->
                        <span class="absolute top-3 right-3 text-xs font-semibold px-3 py-1 rounded-full bg-purple-600 text-white shadow-md">
                            ${game.category}
                        </span>
                    </div>

                    <!-- Game Info -->
                    <div class="p-4">
                        <h2 class="text-xl font-bold text-gray-50 truncate mb-1">${game.title}</h2>
                        <p class="text-sm text-gray-400 line-clamp-2">${game.description}</p>
                        
                        <button class="mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold text-sm hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.01] shadow-lg shadow-indigo-500/50 pointer-events-none">
                            Launch Game
                        </button>
                    </div>
                </div>
            `;
        }


        /**
         * Filters games based on the search term and renders the grid.
         */
        function renderGameCards() {
            const term = searchTerm.toLowerCase();
            const filteredGames = initialGames.filter(game =>
                game.title.toLowerCase().includes(term) ||
                game.category.toLowerCase().includes(term) ||
                game.description.toLowerCase().includes(term)
            );

            countUp(gameCountDisplay, filteredGames.length);
            
            if (filteredGames.length > 0) {
                gameGrid.innerHTML = filteredGames.map(createGameCardHTML).join('');
            } else {
                gameGrid.innerHTML = `
                    <p class="text-xl text-gray-400 col-span-full text-center py-10 border-2 border-dashed border-gray-700 p-6 rounded-xl">
                        <span class="text-2xl block mb-2">üòî</span>
                        No games found matching "${searchTerm}". Try broadening your search!
                    </p>
                `;
            }
        }


        // --- Event Listeners and Initialization ---

        window.onload = async function() {
            await initializeFirebase();
            
            window.addEventListener('message', handleIframeMessage);
            renderGameCards();

            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                renderGameCards();
            });

            closeModalBtn.addEventListener('click', closeGameModal);
            panicButton.addEventListener('click', handlePanic); 

            document.addEventListener('keydown', (e) => {
                // If the game modal is open, ESC closes the modal.
                // Otherwise, ESC triggers the panic function.
                if (e.key === 'Escape') {
                    if (gameModal.classList.contains('flex')) {
                        closeGameModal();
                        e.preventDefault(); 
                    } else {
                        handlePanic(); // Panic button keyboard shortcut
                    }
                }
            });
        };

                // === Expose helper functions so external scripts can reset search ===
        window.renderGameCards = renderGameCards;
        window.setSearchTerm = (val) => {
            searchTerm = String(val || '');
            renderGameCards();
        };

    </script>

<script>
  window.addEventListener('load', () => {
    const splash = document.getElementById('splash');
    setTimeout(() => {
      splash.style.opacity = '0';
      splash.style.transition = 'opacity 0.6s ease';
      setTimeout(() => splash.remove(), 700);
    }, 2200); // stays visible for ~2.2 seconds total
  });
</script>

<!-- Add-to-Home Popup (REPLACE your current popup block with this) -->
<div id="install-popup" class="fixed inset-0 bg-black/70 flex items-center justify-center z-[4000] hidden" aria-hidden="true">
  <div id="install-content" class="bg-gray-900 text-gray-100 rounded-2xl p-6 max-w-2xl w-[92%] shadow-2xl animate-fadeIn overflow-y-auto max-h-[90vh]" role="dialog" aria-modal="true" aria-labelledby="install-title">

    <h2 id="install-title" class="text-2xl font-bold text-purple-300 mb-2 text-center">üì± Add Kivro Games to Your Home Screen</h2>
    <p class="text-gray-300 mb-4 text-center">For the best experience, follow these quick steps:</p>
      <h2 class="text-2xl font-bold text-purple-300 mb-2">üé® Customize Your Icon</h2>
      <!-- Icon selection (with glowing backdrop) -->
<div class="flex justify-center gap-5 mb-5 flex-wrap">
  <div class="relative group select-icon-wrap cursor-pointer transition-transform transform hover:scale-105 active:scale-95">
    <div class="absolute inset-0 rounded-2xl bg-indigo-500/20 blur-xl opacity-60 group-hover:opacity-90 transition-all duration-300"></div>
    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/teamsfake.png" 
         class="select-icon relative w-16 h-16 rounded-xl border-2 border-transparent transition-all duration-300 group-hover:border-indigo-400 group-active:scale-95 shadow-lg" 
         alt="Icon 1">
  </div>

  <div class="relative group select-icon-wrap cursor-pointer transition-transform transform hover:scale-105 active:scale-95">
    <div class="absolute inset-0 rounded-2xl bg-purple-500/20 blur-xl opacity-60 group-hover:opacity-90 transition-all duration-300"></div>
    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Kahoot%20fake.png" 
         class="select-icon relative w-16 h-16 rounded-xl border-2 border-transparent transition-all duration-300 group-hover:border-indigo-400 group-active:scale-95 shadow-lg" 
         alt="Icon 2">
  </div>

  <div class="relative group select-icon-wrap cursor-pointer transition-transform transform hover:scale-105 active:scale-95">
    <div class="absolute inset-0 rounded-2xl bg-pink-500/20 blur-xl opacity-60 group-hover:opacity-90 transition-all duration-300"></div>
    <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/onsigma67.png" 
         class="select-icon relative w-16 h-16 rounded-xl border-2 border-transparent transition-all duration-300 group-hover:border-indigo-400 group-active:scale-95 shadow-lg" 
         alt="Icon 3">
  </div>
</div>

    <!-- Steps (compact grid so it fits landscape) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4 text-center">
      <div class="install-step">
        <div class="number text-lg font-semibold mb-1 text-indigo-400">1</div>
        <p class="text-sm text-gray-300 mb-2">Tap the <strong>Share</strong> icon in Safari.</p>
        <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Tut1.jpg" alt="Step 1" class="rounded-lg shadow-md w-full object-cover">
      </div>

      <div class="install-step">
        <div class="number text-lg font-semibold mb-1 text-indigo-400">2</div>
        <p class="text-sm text-gray-300 mb-2">Scroll down in the menu that appears.</p>
        <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Tut2.jpeg" alt="Step 2" class="rounded-lg shadow-md w-full object-cover">
      </div>

      <div class="install-step">
        <div class="number text-lg font-semibold mb-1 text-indigo-400">3</div>
        <p class="text-sm text-gray-300 mb-2">Tap <strong>Add to Home Screen</strong> ‚Äî done!</p>
        <img src="https://raw.githubusercontent.com/KAYAZzz/CNM-Games/main/Tut3.jpeg" alt="Step 3" class="rounded-lg shadow-md w-full object-cover">
      </div>
    </div>



    <!-- Single button (centered) -->
    <div class="flex justify-center mt-4">
      <button id="close-popup" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-2 rounded-md text-sm font-semibold">Got it ‚Äî Finish</button>
    </div>
  </div>
</div>

<script>
  (function () {
    // Defensive: only run once DOM is ready
    function initInstallPopup() {
      const popup = document.getElementById('install-popup');
      const closeBtn = document.getElementById('close-popup');
      const icons = document.querySelectorAll('.select-icon');

      if (!popup || !closeBtn) return;

      const LS_KEY = 'installDismissedV2';

      // Show popup function (removes hidden)
      function showPopup() {
        if (!popup.classList.contains('hidden')) return;
        popup.classList.remove('hidden');
        popup.setAttribute('aria-hidden', 'false');
        // focus button for keyboard users
        closeBtn.focus({ preventScroll: true });
      }

      // Hide popup function (adds hidden)
      function hidePopup() {
        if (popup.classList.contains('hidden')) return;
        popup.classList.add('hidden');
        popup.setAttribute('aria-hidden', 'true');
      }

      // Only show if not dismissed
      try {
        if (!localStorage.getItem(LS_KEY)) {
          showPopup();
        }
      } catch (e) {
        // localStorage could be unavailable in some browsers; still show popup
        showPopup();
      }

      // Closing
      closeBtn.addEventListener('click', () => {
        try { localStorage.setItem(LS_KEY, 'true'); } catch (e) {}
        hidePopup();
      });

      // click outside content closes
      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          try { localStorage.setItem(LS_KEY, 'true'); } catch (e) {}
          hidePopup();
        }
      });

      // ESC closes
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !popup.classList.contains('hidden')) {
          try { localStorage.setItem(LS_KEY, 'true'); } catch (e) {}
          hidePopup();
        }
      });

      // Icon selection behavior (update apple-touch-icon link if present)
      if (icons && icons.length) {
        icons.forEach(icon => {
          icon.addEventListener('click', () => {
            icons.forEach(i => i.classList.remove('border-indigo-400'));
            icon.classList.add('border-indigo-400');
            const link = document.querySelector("link[rel='apple-touch-icon']");
            if (link) link.href = icon.src;
          });
        });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initInstallPopup);
    } else {
      initInstallPopup();
    }
  })();
</script>




<script>
  // Show popup a few seconds after load
  window.addEventListener('load', () => {
    setTimeout(() => {
      document.getElementById('install-popup').classList.add('active');
    }, 3500);
  });

  // Close it
  document.getElementById('close-popup').addEventListener('click', () => {
    document.getElementById('install-popup').classList.remove('active');
  });

    // Close it
  document.getElementById('skip-popup').addEventListener('click', () => {
    document.getElementById('install-popup').classList.remove('active');
  });
</script>

<script>
  const searchInput = document.getElementById('search-input');
  const clearButton = document.getElementById('clear-search');

  // Show/hide the X icon when user types
  searchInput.addEventListener('input', () => {
    clearButton.classList.toggle('hidden', searchInput.value.trim() === '');
  });

  // Clear search + reset results
  clearButton.addEventListener('click', () => {
    // Clear the input box
    searchInput.value = '';

    // Hide the clear (X) button
    clearButton.classList.add('hidden');

    // Reset the searchTerm used by main game script
    window.searchTerm = '';

    // Re-render the full game grid
    if (typeof renderGameCards === 'function') {
      renderGameCards();
    }
  });
</script>

    <script>
  (function(){
    const input = document.getElementById('search-input');
    const clearBtn = document.getElementById('clear-search');

    if (!input || !clearBtn) return;

    // show/hide X while typing (trimmed check)
    input.addEventListener('input', () => {
      clearBtn.classList.toggle('hidden', input.value.trim() === '');
    });

    // Clear + reset module searchTerm + re-render
    clearBtn.addEventListener('click', () => {
      input.value = '';
      clearBtn.classList.add('hidden');

      // Use helper exposed by module. If not present, fallback to rerender via global function
      if (typeof window.setSearchTerm === 'function') {
        window.setSearchTerm('');
      } else if (typeof window.renderGameCards === 'function') {
        window.searchTerm = '';
        window.renderGameCards();
      } else {
        // last resort: trigger input event so whatever listener runs
        input.dispatchEvent(new Event('input', { bubbles: true }));
      }
    });

    // optional: clear on Escape key when input focused
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        clearBtn.click();
      }
    });
  })();
</script>

	<script>
// Store your ad script as a constant string
const AD_SCRIPT_HTML = `
    <script type="text/javascript">
        atOptions = {
            'key' : '568ecccfdab4fe7219cbc43b33184c71',
            'format' : 'iframe',
            'height' : 300,    /* ADJUSTED HEIGHT */
            'width' : 728,     /* ADJUSTED WIDTH */
            'params' : {}
        };
    </\script>
    <script type="text/javascript" src="//www.highperformanceformat.com/568ecccfdab4fe7219cbc43b33184c71/invoke.js"></\script>
`;

function showAdThenPlay(gameUrl) {

    const AD_DURATION_MS = 100; 

    // 3. Set the timer
    setTimeout(() => {
        
        // 5. Load the game
        openGameModal(gameUrl); 
        
    }, AD_DURATION_MS);
}
</script>

<!-- KIVRO Total Visits Overlay (Real-Time) -->
<style>
  #kivro-widget {
    position: fixed;
    top: 12px;
    left: 12px;
    padding: 10px 14px;
    background: linear-gradient(135deg, #9e3bff, #6a00ff);
    color: white;
    font-family: Arial, sans-serif;
    font-size: 13px;
    border-radius: 12px;
    z-index: 999999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    backdrop-filter: blur(6px);
    border: 1px solid rgba(255,255,255,0.25);
  }

  #kivro-widget .kivro-title {
    font-weight: bold;
    margin-bottom: 4px;
    font-size: 14px;
    letter-spacing: 1px;
  }
</style>

<div id="kivro-widget">
  <div class="kivro-title">KIVRO</div>
  <div>Total Visits Today: <span id="totalVisits">Loading‚Ä¶</span></div>
</div>

<script>
  const VISITORS_API = "https://kivro-counter.vercel.app/api/visitors";

  // --- Count unique visitor once per day in this browser ---
  const lastVisitKey = "kivro-last-visit";
  const now = Date.now();
  const lastVisit = localStorage.getItem(lastVisitKey);

  if (!lastVisit || now - parseInt(lastVisit) > 24*60*60*1000) {
    fetch(VISITORS_API, { method: "POST" }).catch(err => console.error(err));
    localStorage.setItem(lastVisitKey, now.toString());
  }

  // --- Function to update total visits ---
  function updateTotalVisits() {
    fetch(VISITORS_API)
      .then(res => res.json())
      .then(data => {
        const totalElem = document.getElementById("totalVisits");
        if (totalElem) totalElem.innerText = data.totalVisitors;
      })
      .catch(err => console.error("Failed to fetch total visits:", err));
  }

  // --- Initial load ---
  updateTotalVisits();

  // --- Real-time refresh every 5 seconds ---
  setInterval(updateTotalVisits, 5000);
</script>

	
</body>
</html>


